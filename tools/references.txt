Gmail	John Heninger <jhn.heninger@gmail.com>
templates
Heninger, John <John.Heninger@cra-arc.gc.ca>	Tue, Jan 30, 2024 at 10:10 AM
To: "jhn.heninger@gmail.com" <jhn.heninger@gmail.com>

Categorization: Unclassified

Blank template

 

Dim dblist() AS string

Dim ValidValueArg1() AS string

Dim ValidValueArg2() AS string

Dim ValidValueArg3() AS string

Dim ValidValueArg4() AS string

Dim listbox1() AS string

Dim listbox2() AS string

Dim fieldlistbox1() AS string

Dim fieldlistbox2() AS string

 

Begin Dialog DlgMenu 29,0,390,365," ", .DlgMenuDisplay

  OKButton 243,324,50,14, "OK", .btnOK

  CancelButton 314,324,50,14, "Exit", .btnCancel

  DropListBox 147,51,212,11, dblist(), .dlbDb

  DropListBox 238,174,119,15, ValidValueArg1(), .dlbarg1fields

  DropListBox 238,193,119,11, ValidValueArg2(), .dlbarg2fields

  DropListBox 238,214,119,10, ValidValueArg3(), .dlbarg3fields

  Text 35,172,173,10, " All fields", .lblArg1

  Text 33,192,171,10, " Numeric fields", .lblArg2

  Text 34,211,171,10, " Character fields", .lblArg3

  PushButton 336,6,24,11, "FR", .btnlng

  PushButton 147,66,10,13, "...", .btnChoosedb

  PushButton 147,86,114,12, "Select multiple files", .btnMultipleFilesSelect

  TextBox 147,103,213,24, .TxtDb, 2052

  PushButton 237,144,118,14, "Select Fields", .btnMultipleFieldsSelect

  Text 21,250,239,65, " ", .lblValidation

  Text 272,252,91,62, " ", .debugvalue

  Text 8,4,175,26, " Blank Macro Template Menu", .lbltitle

  DropListBox 238,231,119,11, ValidValueArg4(), .dlbarg4fields

  Text 34,229,171,10, " Datefields", .lblArg4

  Text 15,133,173,10, "Example of a select fields menu", .lblMultFields

  Text 16,35,173,10, "Example of a select files menus", .lblMultFiles

  Text 26,52,103,9, "Drop list", .lblDropList

  Text 27,68,103,9, "Browser", .lblBrowser

  Text 27,86,103,9, "Pick list", .lblPickList

  Text 27,104,103,9, "Result", .lblFileResult

  Text 26,146,103,9, "Pick list", .lblPickList1

  Text 26,161,103,9, "Drop list", .lblDropList1

End Dialog

 

Begin Dialog dlgchoosefiles 8,0,703,340," ", .dlgChooseFIlesDisplay

  ListBox 16,37,227,222, listbox1(), .ListBox1

  ListBox 406,41,227,222, listbox2(), .ListBox2

  PushButton 314,50,30,30, ">", .btnAddOne

  PushButton 314,116,30,34, "<", .btnRemoveOne

  PushButton 314,84,30,30, ">>", .btnAddAll

  PushButton 314,152,30,33, "<<", .btnRemoveAll

  OKButton 253,276,59,35, "OK", .btnOk

  CancelButton 341,276,59,35, "Cancel", .btnCancel

  Text 15,21,294,14, "Pick List (Not Included):", .lblNoPick

  Text 404,25,267,13, "Pick List (Will be added to the selection):", .lblPick

  Text 3,3,265,10, "Select Items to include", .txttitle

  TextBox 256,245,137,17, .txtSearch

  PushButton 246,228,153,13, "> Add Accounts based on search", .btnSearch

End Dialog

 

Begin Dialog dlgchoosefields 8,0,684,341," ", .dlgChooseFieldsDisplay

  ListBox 16,37,227,222, fieldlistbox1(), .fieldsListBox1

  ListBox 378,37,214,222, fieldlistbox2(), .fieldsListBox2

  PushButton 295,43,30,30, ">", .btnAddOne

  PushButton 295,109,30,34, "<", .btnRemoveOne

  PushButton 295,77,30,30, ">>", .btnAddAll

  PushButton 295,145,30,33, "<<", .btnRemoveAll

  OKButton 237,272,59,35, "OK", .btnOk

  CancelButton 325,272,59,35, "Cancel", .btnCancel

  Text 15,21,262,14, "Pick List (Not Included):", .lblNoPick

  Text 380,21,272,13, "Pick List (Will be added to the selection):", .lblPick

  Text 3,3,266,10, "Select Items to include", .txttitle

  TextBox 249,245,122,17, .txtSearch

  PushButton 249,227,123,13, "> Add Fields based on search", .btnSearch

End Dialog

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

' IDEAScript: Blank Macro Template.iss

' Author: Jean-François Gauthier

' Date: Feb 6, 2023

' Purpose: To provide a blank macro to use with the IdeaScript Repository (ISR)

' Disclaimer:This script is provided as is without any warranties.

' UserType:CAS

' Translation: Jean-François Gauthier

' Nom français: Modèle de macro vide

' But: Fournir un modèle de macro vide avec l'entête pour utilisation avec le Répertoire de macros IdeaScript (RIS)

' Déclaration: Ce script est fourni tel quel sans aucune garantie.

 

 

 

 

 

 

 

Option Explicit

 

Dim vbcrlf$ ' carriage return and line feed

Dim ls$' list separator

Dim IdeaLanguage$ 'Holds the language of the installed Idea instance.

Dim GUILanguage$ 'Holds the current language selected

 

Dim allfields() As String 'holds the list of all fields names in a selected database

Dim numfields() As String 'holds the list of all numeric fields names in a selected database

Dim charfields() As String 'holds the list of all character fields names in a selected database

Dim datefields() As String 'holds the list of all date fields names in a selected database

Dim fieldslist() As String 'holds the list of all fields names in a selected database

Dim dbcollection As Object 'hold the collection of all databases in the project. This is different from the dblist array.

 

Dim tempListbox1() As String 'holds the temporary unselected files

Dim tempListbox2() As String 'holds the temporary selected files

Dim fieldstempListbox1() As String 'holds the temporary unselected fields

Dim fieldstempListbox2() As String 'holds the temporary selected fields

Dim Selecteddblist() As String 'holds the selected files

Dim SelectedFieldslist() As String 'holds the selected fields

Dim SearchArray() As String 'holds an array of search strings

 

Dim selectedarg1IndexValue As Double ' holds the position of the first field list box

Dim selectedarg2IndexValue As Double ' holds the position of the second field list box

Dim selectedarg3IndexValue As Double ' holds the position of the third field list box

Dim selectedarg4IndexValue As Double ' holds the position of the forth field list box

Dim selectedarg1StrValue As String ' holds the contents of the first field list box

Dim selectedarg2StrValue As String ' holds the contents of the second field list box

Dim selectedarg3StrValue As String ' holds the contents of the third field list box

Dim selectedarg4StrValue As String ' holds the contents of the forth field list box

 

Dim CurrentDatabaseName As String' holds the current database name

Dim CurrentDatabaseBaseName As String ' holds the current database base name (only the file name)

Dim dbChosenWithBrowser As String' holds the path of the file chosen with the browser

Dim selecteddbTextValue As String' holds the name of the selected file in the drop list

Dim selecteddbIndexValue As Double  'holds the postition of the selected in the drop list

Dim ENCurrentDBList As String 'holds the displayed text for the current database, in english

Dim FRCurrentDBList As String 'holds the displayed text for the current database, in french

Dim bilingualCurrentDBList As String 'holds the displayed text for the current database, depending on the current language

 

Dim SearchString As String 'holds the search criteria for pick lists

 

Dim tempListSelect1 As Double 'position in the file pick list

Dim tempListSelect2 As Double 'position in the file pick list

Dim fieldstempListSelect1 As Double 'position in the field pick list

Dim fieldstempListSelect2 As Double 'position in the field pick list

Dim numofdb As Double 'holds the total number of databases in the project

 

Dim dlgMenuInstance As dlgMenu 'main interface

Dim dlgChooseFilesInstance As dlgChooseFiles 'choose files interface

Dim dlgChooseFieldsInstance As dlgChooseFields 'choose fields interface

 

Dim ExitFilesMenu As Boolean

Dim ExitFieldsMenu As Boolean

Dim ExitScript As Boolean

Dim ApplyToSelected As Boolean

 

Dim choice As Integer

 

' ================================================================================

Sub Main

               Init        

                             

               Do         

                              choice = Dialog(dlgMenuInstance)

                              If choice = 0 Then

                                             ExitScript=1         '0=btnCancel     

                              End If

                             

                              If ExitScript = 0 Then      

                                             'do something before exit

                              End If                  

                           client.refreshfileexplorer                                                          

               Loop Until ExitScript

              

               If GUILanguage = "EN" Then

                              MsgBox "Script ended."

               Else

                              MsgBox "Script terminé."             

               End If

              

End Sub

' ================================================================================

 

' ================================================================================

Sub Init

'added by Jean-François Gauthier

'initial assignement of variables and constants.

 

               'sets default values for field lists to empty.

               ReDim numfields(0)

               ReDim charfields(0)

               ReDim datefields(0)

               ReDim allfields(1)

               numfields(0) = "-"

               charfields(0) = "-"

               datefields(0) = "-"

               allfields(0) = "-"

                                            

               'sets default values for files lists to empty.

               ReDim dblist(1)

               dblist(0) = "-"

               ReDim Selecteddblist(0)

              

               'sets temporary arrays to empty.

               ReDim tempListbox1(0)

               ReDim tempListbox2(0)

               ReDim fieldstempListbox1(0)

               ReDim fieldstempListbox2(0)

               tempListbox1(0)="-"

               tempListbox2(0)="-"

               fieldstempListbox1(0)="-"

               fieldstempListbox2(0)="-"

                                                           

               'create the carriage return constant

               vbcrlf = Chr(13) & Chr(10)           

                                                           

               'get Idea Language constant

               Dim InstallInfoObj  As Object

               Set InstallInfoObj = CreateObject("Idea.InstallInfo")

               IdeaLanguage = UCase(InstallInfoObj.AppLanguage)

               Set InstallInfoObj = Nothing

              

               'set GuiLanguage variable, same as IdeaLanguage for now, but user could change it.

               GUILanguage = IdeaLanguage                   

              

               'get Windows List Separator constant

               Dim WSHShell As Object

               Set WSHShell = CreateObject("WScript.Shell")

               ls = WSHShell.RegRead("HKEY_CURRENT_USER\CONTROL PANEL\International\sList")

               Set WSHShell = Nothing

                             

               'get databases collection

               Dim task As Object: Set task = client.ProjectManagement                             

               Set dbcollection = task.Databases

               numofdb = dbcollection.Count

               ReDim dblist(numofdb + 1)

              

End Sub

' ================================================================================

 

 

 

' ================================================================================

Function LoadDbCollection(ByRef refdblist() As String, lng$)

'added by Jean-François Gauthier

'Takes an array refdblist() and the language, and fills the array with a list of all databases in the current project.

'First entry will be the current database, and the display will be language-dependent.

 

               Dim s% , i%        

              

               On Error Resume Next

               If CurrentDatabaseName = "" Or CurrentDatabaseName = "-"  Then

                              CurrentDatabaseName =Client.CurrentDatabase.name

                              CurrentDatabaseBaseName = isplit(CurrentDatabaseName, "" , "\", 1,1)

                              selecteddbTextValue=CurrentDatabaseName

                              ENCurrentDBList="Current database (" & CurrentDatabaseBaseName & ")"

                              FRCurrentDBList= "Base de données courante (" & CurrentDatabaseBaseName & ")"                            

               End If

              

               'client.closeall

               client.opendatabase(CurrentDatabaseName)

              

               On Error GoTo 0              

                             

               If lng = "EN" Then

                              bilingualCurrentDBList=ENCurrentDBList

               Else

                              bilingualCurrentDBList= FRCurrentDBList

               End If

 

               If CurrentDatabaseBaseName = "" Then

                              bilingualCurrentDBList="-"           

                              ENCurrentDBList="-"

                              FRCurrentDBList="-"                                                                   

               End If

              

               refdblist(0) =bilingualCurrentDBList

               s =1       

 

 

               ' Iterate throught the coll to get the database names

 

               For i = 1 To numofdb

                              refdblist(s) = dbcollection.GetAt(i - 1)

                              s = s + 1

               Next i

End Function

' ================================================================================

 

' ================================================================================

Function LoadFieldLists(DatabaseListSelection As String, charfields() As String, numfields() As String, datefields() As String, allfields() As String)

'added by Jean-François Gauthier

'This will populate a droplist with field names.

'DatabaseListSelection is the database file name

'charfields() , numfields() , datefields() , allfields() are 4 arrays of strings.

'These arrays will be emptied, filled with the corresponding values, and sent back to the main sub for future use.

 

                              selectedarg1IndexValue=0

                              selectedarg2IndexValue=0

                              selectedarg3IndexValue=0

                              selectedarg4IndexValue=0

                              selectedarg1StrValue=""

                              selectedarg2StrValue=""

                              selectedarg3StrValue=""               

                              selectedarg4StrValue=""               

                                            

                              ReDim charfields(0)

                              ReDim numfields(0)

                              ReDim datefields(0)

                              ReDim allfields(0)

                              Dim dbname As String

                              Dim field As Object

                              Dim db1 As Object

                              Dim objfieldsList As Object

                              Dim fieldscount As Integer

                              Dim tempfieldname$, tempfieldnameNum$                                      

                             

                              dbname=DatabaseListSelection

 

 

                              If  dbname <> "" And dbname <> "-" Then            

                                             On Error Resume Next

 

                                             Set db1 = client.opendatabase(dbname)

 

                                             Set objfieldsList = db1.TableDef

                                             fieldscount = objfieldsList.count

                                            

                                             Dim i%,j%,k%,l%,m%

                                             i=0

 

                                             charfields(0) = "-"

                                             numfields(0) = "-"

                                             datefields(0) = "-"

                                             allfields(0) = "-"

                                            

                                             j=1

                                             k=1

                                             l=1

                                             m=1                                    

                                            

                                             For i = 0 To fieldscount-1             

                                                            Set field = objfieldsList.GetFieldat(i+1)                                                 

                                                            tempfieldname=field.Name

                                                           

                                                            If field.ischaracter Then

                                                                           ReDim preserve charfields(j)                                                   

                                                                           charfields(j) = tempfieldname

                                                                           j=j+1                    

                                                            End If                                 

                                                           

                                                            If field.isnumeric Then

                                                                           ReDim preserve numfields(k)                                                  

                                                                           numfields(k) = tempfieldname

                                                                           k=k+1                  

                                                            End If                  

                                                           

                                                            If field.isdate Then

                                                                           ReDim preserve datefields(l)                                                   

                                                                           datefields(l) = tempfieldname

                                                                           l=l+1                    

                                                            End If   

                                                           

                                                            ReDim preserve allfields(m)        

                                                            allfields(m) = tempfieldname

                                                            m=m+1                                                                           

                                                                                                                                                                                   

                                                            Set field = Nothing                                                                      

                                                            If i >= fieldscount Then Exit For

                                             Next i

 

                                             Set objfieldsList = Nothing

                                             Set db1 = Nothing

                                                           

                                             Else

                                                            'skip if DatabaseListSelection is empty                                                                

                              End If

                             

                              If fieldscount > 1 Then

                                             QuickSort charfields

                                             QuickSort numfields

                                             QuickSort datefields

                                             QuickSort allfields

                              End If                                                                              

                             

                             

                              dlglistboxarray "dlbarg1fields", allfields

                              dlglistboxarray "dlbarg2fields", numfields           

                              dlglistboxarray "dlbarg3fields", charfields           

                              dlglistboxarray "dlbarg4fields", datefields                                         

End Function

' ================================================================================

 

 

' ================================================================================

Function dlgMenuDisplay(controlID$, action%, suppValue%)

'added by Jean-François Gauthier to manage the GUI

 

               Select Case action

                              Case 1 ' Initialize                                            

                                             If selecteddbTextValue = "" Then                                                          

                                                            LoadDbCollection dblist() , GUILanguage

                                                            dlglistboxarray "dlbDb",                dblist                                                                               

                                                            selecteddbIndexValue = dlgvalue("dlbDb")

 

                                                            If CurrentDatabaseName <> "" Then

                                                                           selecteddbTextValue=CurrentDatabaseName                                                                  

                                                                           client.opendatabase(selecteddbTextValue)

                                                            Else

                                                                           selecteddbTextValue=""

                                                                           selecteddbIndexValue=0

                                                            End If                                                

                                                            selecteddbTextValue=dlgtext("dlbDb")

                                                           

                                             End If

                                            

                                             dlgtext "txtdb", selecteddbTextValue

                                            

                                             UpdateDlgMenuDisplay                                                                                                                                                                                     

                                             LoadFieldLists CurrentDatabaseName, charfields,numfields,datefields,allfields

 

                                                           

                              Case 2 ' Click     

                                             DlgMenuDisplay=1          

                                                                                                                                                     

                                             Select Case controlID     

                                                            Case "btnMultipleFilesSelect"

                                                                           Dim dlgChooseFilesInstanceReturn As Double

                                                                           listbox1=dblist

                                                                           dlgChooseFilesInstanceReturn = Dialog(dlgChooseFilesInstance)

                                                                           If dlgChooseFilesInstanceReturn = -1 Then

                                                                                          If GUILanguage = "EN" Then

                                                                                                         dblist(0) = "Multiple files list will be used. First file: "                                                                                                        

                                                                                          Else

                                                                                                         dblist(0) = "Utilisation de la liste de fichiers. Premier fichier: "                                                                                       

                                                                                          End If

                                                                                          ApplyToSelected = true

                                                                                          dlglistboxarray "dlbDb" , dblist                                                                              

                                                                                          selecteddbTextValue = Selecteddblist(0)

                                                                                          dlgtext "txtdb", dblist(0)  & isplit(selecteddbTextValue,"" , "\",1,1)

                                                                                          client.opendatabase(selecteddbTextValue)

                                                                                          CurrentDatabaseName=selecteddbTextValue

                                                                                          ReDim fieldstempListbox1(0)

                                                                                          ReDim fieldstempListbox2(0)      

                                                                                                                                      

                                                                                          'MsgBox selecteddbTextValue

                                                                           Else

                                                                                          ApplyToSelected = false

                                                                                          ReDim Selecteddblist(0)

                                                                                          ReDim SelectedFieldslist(0)

                                                                                          dblist(0) = CurrentDatabaseName                                                                                       

                                                                                          selecteddbTextValue=CurrentDatabaseName

                                                                                          dlgtext "txtdb", dblist(0)  &  isplit(selecteddbTextValue,"" , "\",1,1)

                                                                                          LoadDbCollection dblist() , GUILanguage

                                                                           End If                                 

                                                                          

                                                                           dlglistboxarray "dlbDb",                dblist

                                                                           selecteddbIndexValue = dlgvalue("dlbDb")

 

                                                                           UpdateDlgMenuDisplay

                                                                           LoadFieldLists selecteddbTextValue, charfields,numfields,datefields,allfields  

 

                                                                                                                                                                                                                                                                             

                                                            Case "btnChoosedb"                                                                   

                                                                           dbChosenWithBrowser=BrowseForFile() 

                                                                           client.closeall                                                                               

                                                                           If dbChosenWithBrowser <> "" Then

                                                                                          ApplyToSelected = false

                                                                                          ReDim tempListbox1(0)

                                                                                          ReDim tempListbox2(0)

                                                                                          ReDim Selecteddblist(0)

                                                                                          ReDim SelectedFieldslist(0)

                                                                                          selecteddbTextValue=dbChosenWithBrowser                                    

                                                                                          client.opendatabase(selecteddbTextValue)

                                                                                          selecteddbIndexValue=0                                            

                                                                                          CurrentDatabaseName = ""

                                                                                          dlgtext "txtdb", isplit(selecteddbTextValue,"" , "\",1,1)

                                                                                          LoadDbCollection dblist() , GUILanguage                                                                           

                                                                                          dlglistboxarray "dlbDb",                dblist    

                                                                                                                                                                                                  

                                                                                          'LoadDbCollection dblist() , GUILanguage

                                                                                          'dlglistboxarray "dlbDb" , dblist                                                                                            

                                                                                          UpdateDlgMenuDisplay

                                                                                          selecteddbTextValue=dbChosenWithBrowser                                                                                                               

                                                                                          LoadFieldLists selecteddbTextValue, charfields,numfields,datefields,allfields

                                                                                          ReDim fieldstempListbox1(0)

                                                                                          ReDim fieldstempListbox2(0)                                                                                                

                                                                           End If                                                               

                                                                          

                                                            Case "btnlng"

                                                                           If GUILanguage = "EN" Then GUILanguage ="FR" Else GUILanguage  = "EN"     

                                                                           dlglistboxarray "dlbDb" , dblist                                                                                             

                                                                           If CurrentDatabaseName <> "" Then

                                                                                          selecteddbTextValue=CurrentDatabaseName                                                                  

                                                                                          client.opendatabase(selecteddbTextValue)

                                                                           Else

                                                                                          selecteddbTextValue=""

                                                                                          selecteddbIndexValue=0

                                                                           End If

                                                                           LoadFieldLists selecteddbTextValue, charfields,numfields,datefields,allfields

                                                                           UpdateDlgMenuDisplay

                                                           

                                                            Case "dlbarg1fields"

                                                                           selectedarg1IndexValue=SuppValue                                                     

                                                                           selectedarg1StrValue=dlgtext(ControlId)                                                            

                                                                          

                                                            Case "dlbarg2fields"

                                                                           selectedarg2IndexValue=SuppValue                                                     

                                                                           selectedarg2StrValue = dlgtext(ControlId)             

                                                           

                                                            Case "dlbarg3fields"

                                                                           selectedarg3IndexValue=SuppValue                                                     

                                                                           selectedarg3StrValue= dlgtext(ControlId)              

                                                           

                                                            Case "dlbarg4fields"

                                                                           selectedarg4IndexValue=SuppValue                                                     

                                                                           selectedarg4StrValue= dlgtext(ControlId)              

 

                                                            Case "dlbDb"                    

                                                                           client.closeall    

                                                                           selecteddbIndexValue = dlgvalue("dlbDb")

                                                                           selecteddbTextValue=dlgtext("dlbDb")   

                                                                                                                                                     

                                                                           If selecteddbIndexValue=0 And CurrentDatabaseName <> "" Then selecteddbTextValue=CurrentDatabaseName

                                                                          

                                                                           LoadFieldLists selecteddbTextValue, charfields,numfields,datefields,allfields                                

                                                                           ReDim fieldstempListbox1(0)

                                                                           ReDim fieldstempListbox2(0)      

                                                                                                                                                                                                                                                                             

                                                                           If GUILanguage = "EN" Then

                                                                                          dblist(0)=ENCurrentDBList

                                                                                          Else

                                                                                          dblist(0)=FRCurrentDBList                                                                        

                                                                           End If

                                                                          

                                                                           dlgtext "txtdb", selecteddbTextValue

                                                                                         

                                                            Case Left(ControlId, 23) = "btnMultipleFieldsSelect"

                                                                           Dim btnFields As Boolean

                                                                           btnFields = Dialog(dlgChooseFieldsInstance)

                                                                           DlgMenuDisplay=1

                                                                                                                                                                                                                                                                                                                                                                       

                                                            Case "btnOk"

                                                                           ClickOk

                                                                           ' DlgMenuDisplay=0 to exit

                                                                           ' DlgMenuDisplay=1 to stay

                                                                           DlgMenuDisplay=0

                                                                           ExitScript = 1 '1 will exit, 0 wil

                                                                          

                                                            Case "btnCancel"

                                                                           DlgMenuDisplay=0

                                                                          

                                             End Select                                        

               End Select

               ValidateSelections

              

End Function

' ================================================================================

 

' ================================================================================

Function ClickOk

               'do anything here

End Function

' ================================================================================

 

' ================================================================================

Function ValidateSelections

               Dim lblValidationString As String

               lblValidationString = "Validation:" & vbcrlf

              

               If GUILanguage = "EN" Then

                              If ( tempListbox2(0) = "" Or tempListbox2(0) = "-"  ) And UBound(tempListbox2) = 0 Then

                                             lblValidationString = lblValidationString & "Number of databases selected with the button:0" & vbcrlf

                              Else

                                             lblValidationString = lblValidationString & "Number of databases selected with the button:" & UBound(tempListbox2)+1 & vbcrlf

                              End If

                             

                              If ( fieldstempListbox2(0) = "" Or fieldstempListbox2(0) = "-"  ) And UBound(fieldstempListbox2) = 0 Then

                                             lblValidationString = lblValidationString & "Number of fields selected with the button:" & UBound(fieldstempListbox2)  & selectedarg1StrValue & vbcrlf

                              Else

                                             lblValidationString = lblValidationString & "Number of fields selected with the button:" & UBound(fieldstempListbox2) +1 & selectedarg1StrValue & vbcrlf

                              End If

              

                              lblValidationString = lblValidationString & "selectedarg1StrValue:" & selectedarg1StrValue & vbcrlf

                              lblValidationString = lblValidationString & "selectedarg2StrValue:" & selectedarg2StrValue & vbcrlf

                              lblValidationString = lblValidationString & "selectedarg3StrValue:" & selectedarg3StrValue & vbcrlf

                              lblValidationString = lblValidationString & "selectedarg4StrValue:" & selectedarg4StrValue & vbcrlf

                              lblValidationString =  lblValidationString & "Insert something else here..." & vbcrlf    

                              dlgtext "lblValidation", lblValidationString

                                            

                              dlgtext "debugvalue", "Debug: Test values with this debug label..."

                              'here, you can enable or disable the Ok button, depending on the requirements

               Else

                              If ( tempListbox2(0) = "" Or tempListbox2(0) = "-"  ) And UBound(tempListbox2) = 0 Then

                                             lblValidationString = lblValidationString & "Fichiers sélectionnés avec le bouton:0" & vbcrlf

                              Else

                                             lblValidationString = lblValidationString & "Fichiers sélectionnés avec le bouton:" & UBound(tempListbox2)+1 & vbcrlf

                              End If

                             

                              If ( fieldstempListbox2(0) = "" Or fieldstempListbox2(0) = "-"  ) And UBound(fieldstempListbox2) = 0 Then

                                             lblValidationString = lblValidationString & "Champs sélectionnés avec le bouton:" & UBound(fieldstempListbox2)  &  vbcrlf

                              Else

                                             lblValidationString = lblValidationString & "Champs sélectionnés avec le bouton:" & UBound(fieldstempListbox2) +1 &  vbcrlf

                              End If

              

                              lblValidationString = lblValidationString & "selectedarg1StrValue:" & selectedarg1StrValue & vbcrlf

                              lblValidationString = lblValidationString & "selectedarg2StrValue:" & selectedarg2StrValue & vbcrlf

                              lblValidationString = lblValidationString & "selectedarg3StrValue:" & selectedarg3StrValue & vbcrlf

                              lblValidationString = lblValidationString & "selectedarg4StrValue:" & selectedarg4StrValue & vbcrlf

                              lblValidationString =  lblValidationString & "Ajouter quelquechose ici..." & vbcrlf    

                              dlgtext "lblValidation", lblValidationString

                                            

                              dlgtext "debugvalue", "Debug: Tester des valeurs avec cette étiquette de débug..."

                              'here, you can enable or disable the Ok button, depending on the requirements     

              

               End If

End Function

' ================================================================================

 

 

' ================================================================================

Function UpdateDlgMenuDisplay()                          

'to alternate the interface between English and French                                                                             

                                                                                         

 

               If GUILanguage="EN" Then

                              If dblist(0) = "Utilisation de la liste de fichiers. Premier fichier: " Then

                                             dblist(0) = "Multiple files list will be used. First file: "

                                             dlgtext "txtdb", dblist(0)  & isplit(selecteddbTextValue,"" , "\",1,1)

                              End If

                             

                              bilingualCurrentDBList=ENCurrentDBList                              

                              dlgtext "lblTitle", " Blank Macro Template Menu"                                           

                              dlgtext "btnlng", "FR"    

                              dlgtext "btnMultipleFilesSelect", "Select Multiple Files"

                              dlgtext "btnMultipleFieldsSelect", "Select Fields"

                              dlgtext "lblMultipleFieldsSelect", "Current action will be applied to all fields by default. Please click here to select fields:"

                             

                              dlgtext "btnCancel","Cancel"

                              dlgtext "lbldb" , "Choose a database:" 

                             

                              dlgtext "lblArg1",  "Any field example:"

                              dlgtext "lblArg2",  "NUMERIC field example:"

                              dlgtext "lblArg3",  "CHARACTER field example:"                                

                              dlgtext "lblArg4",  "DATE field example:"

                             

                              dlgtext "lblMultFiles",  "Example of a select files menus"

                              dlgtext "lblDropList",  "Droplist"                                             

                              dlgtext "lblBrowser",  "Browser"                                            

                              dlgtext "lblPickList",  "Picklist"                  

                              dlgtext "lblFileResult",  "Result"                                             

 

                              dlgtext "lblMultFields",  "Example of a select fields menu"

                              dlgtext "lblDropList1",  "Droplist"                                          

                              dlgtext "lblPickList1",  "Picklist"                                             

                             

                             

               Else

                              bilingualCurrentDBList=ENCurrentDBList

                             

                              If dblist(0) = "Multiple files list will be used. First file: " Then

                                             dblist(0) = "Utilisation de la liste de fichiers. Premier fichier: "

                                             dlgtext "txtdb", dblist(0)  & isplit(selecteddbTextValue,"" , "\",1,1)

                              End If

                                                                          

                              dlgtext "lblTitle", " Menu du modèle de macro vide"                       

                              dlgtext "btnlng", "EN"   

                              dlgtext "btnMultipleFilesSelect", "Choisir plusieurs fichiers"         

                              dlgtext "btnMultipleFieldsSelect", "Chosir des champs"

                              dlgtext "lblMultipleFieldsSelect", "La présente action affectera tous les champs. Sinon, cliquez ici pour choisir des champs:"                                                                    

                             

                              dlgtext "btnCancel","Annuler"

                              dlgtext "lbldb" , "Choisissez une base de données:" 

 

                              dlgtext "lblArg1",  "Ex. n'importe quel champ:"

                              dlgtext "lblArg2",  "Ex. champ NUMÉRIQUE:"

                              dlgtext "lblArg3", "Ex. champ CARACTÈRE:"                                       

                              dlgtext "lblArg4", "Ex. champ DATE:"

                             

                              dlgtext "lblMultFiles",  "Exemple de choix de fichiers"

                              dlgtext "lblDropList",  "Liste déroulante"                                            

                              dlgtext "lblBrowser",  "Explorateur"                                      

                              dlgtext "lblPickList",  "Liste de choix"                     

                              dlgtext "lblFileResult",  "Resultat"                                          

 

                              dlgtext "lblMultFields",  "Exemple de choix de champs"                 

                              dlgtext "lblDropList1",  "Liste déroulante"                                          

                              dlgtext "lblPickList1",  "Liste de choix"                                                 

               End If

              

               If  dblist(0) <>  "Multiple files list will be used. First file: " And dblist(0) <> "Utilisation de la liste de fichiers. Premier fichier: "   Then

                              dblist(0) = bilingualCurrentDBList              

               End If   

End Function

' ================================================================================              

 

 

' ================================================================================

Function dlgChooseFilesDisplay(ControlID$, Action%, SuppValue%)           

'****************************************************************************************************

'   Name:              dlgChooseFIlesDisplay

'   Description:    Routine to control the select files dialog

' Credits: unkown

'****************************************************************************************************

               Dim i As Double

               Dim j As Double

               Dim k As Double, l As Double 'used to update tempListbox1 and 2 array

               Dim bListBox2Set As Boolean 'flag to show item was in placed in listbox2

               Dim SearchString As String

              

               Select Case Action

                              Case 1

                              'initialize the variables

                              If GUILanguage = "EN" Then

                                             dlgtext "txtTitle", "Select Items to include"

                                             dlgtext "lblNoPick","Pick List (these items will NOT be added to the selection):"

                                             dlgtext "lblPick","Pick List (these items will be added to the selection):"

                                             dlgtext "btnGST","> Add 'GST/ITC' "

                                             dlgtext "btnSales","> Add 'Sales'  "

                                             dlgtext "btnSearch","> Add based on search"

                                             Else

                                             dlgtext "txtTitle", "Choisir des items à inclure"

                                             dlgtext "lblNoPick","Liste de sélection (ces items ne seront PAS inclus à la sélection)"

                                             dlgtext "lblPick","Liste des items choisis (ces items seront ajoutés à la sélection)"

                                             dlgtext "btnGST", "> Ajouter 'TPS/TVH'"

                                             dlgtext "btnSales","> Ajouter 'Ventes'"

                                             dlgtext "btnSearch","> Ajouter selon une recherche"

                                             dlgtext "btnCancel","Annuler"                                                                               

                              End If

                              l = 0

                              k = 0

                             

                              Dim tempcurrdb As String

                             

                              If Len(dblist(0)) > 19 Then

                                             tempcurrdb = Mid(dblist(0), 19, Len(dblist(0)) - 18 - 1)

                              End If

                             

                              Dim tempcurrdb2 As String                        

                             

 

                              If UBound(tempListbox1) = 0 Then

                                             For i = 0 To UBound(dblist)                                                       

                                                            ReDim Preserve tempListbox1(UBound(tempListbox1) + 1)

                                                            If Left(dblist(i),18) = "Current database (" Then

                                                                           tempcurrdb2 = "--" & Mid(dblist(i), 19, Len(dblist(i)) - 18 - 1)

                                                                            tempListbox1(i) = tempcurrdb2                                                                           

                                                            Else

                                                                           tempcurrdb2 = ""

                                                            End If                                                                                                            

                                                            If dblist(i) <> "-" And dblist(i) <> tempcurrdb And i <> 0 Then

                                                                            tempListbox1(i) = dblist(i)           

                                                            End If

                                             Next i

                              End If

                             

                              Call sortArray(tempListbox1)

                              Call removeBlanksFromArray(1)

                             

                              DlgListBoxArray "ListBox1", tempListbox1             

                              DlgListBoxArray "ListBox2", tempListbox2

                              tempListSelect1 = 0  'set to 1st items as default

                              Case 2

                              Select Case ControlID

                                             Case "btnSearch"

                                                            SearchString = dlgtext("txtSearch")

                                                            ReDim SearchArray(0)

                                                            SearchArray(0)=SearchString                                                   

                                                           

                                                            SearchForMatches

                                                           

                                                            If UBound(tempListbox1) >= 0 Then

                                                                           Call sortArray(tempListbox1)                                     

                                                                           Call removeBlanksFromArray(1)                                                                                                                                        

                                                            End If

                                                           

                                                            If UBound(tempListbox2) >= 0 Then

                                                                           Call sortArray(tempListBox2)

                                                                           Call removeBlanksFromArray(2)

                                                            End If

                                                           

                                                            DlgListBoxArray "ListBox2", tempListBox2()                         

                                                            DlgListBoxArray "ListBox1", tempListbox1()

                                                            tempListSelect1 = 0 'set to 1st items as default

                                                            ExitFilesMenu = False                                                 

                                                                                                                                                                                   

                                             Case "btnAddOne"

                                                            If tempListbox1(tempListSelect1) <> "-" Then

                                                                           If UBound(tempListbox1) >= 0 Then

                                                                                         

                                                                                          ReDim Preserve tempListBox2(UBound(tempListBox2) + 1)

                                                                                         

                                                                                          tempListBox2(UBound(tempListBox2)) = tempListbox1(tempListSelect1)

                                                                                         

                                                                                          tempListbox1(tempListSelect1) = ""

                                                                                         

                                                                                          Call sortArray(tempListbox1)

                                                                                          'Call sortArray(tempListBox2)

                                                                                          Call removeBlanksFromArray(1)

                                                                                          Call removeBlanksFromArray(2)

                                                                                         

                                                                           End If

                                                                           DlgListBoxArray "ListBox2", tempListBox2()

                                                                          

                                                                           DlgListBoxArray "ListBox1", tempListbox1()

                                                                           tempListSelect1 = 0 'set to 1st items as default

                                                                           ExitFilesMenu = False

                                                            End If

                                                           

                                             Case "btnRemoveOne"

                                                            If UBound(tempListBox2) >= 0 Then

                                                                          

                                                                           ReDim Preserve tempListbox1(UBound(tempListbox1) + 1)

                                                                          

                                                                           tempListbox1(UBound(tempListbox1)) = tempListBox2(tempListSelect2)

                                                                          

                                                                           tempListBox2(tempListSelect2) = ""

                                                                          

                                                                           Call sortArray(tempListbox1)

                                                                           'Call sortArray(tempListBox2)

                                                                           Call removeBlanksFromArray(1)

                                                                           Call removeBlanksFromArray(2)

                                                                          

                                                            End If

                                                            DlgListBoxArray "ListBox2", tempListBox2()

                                                           

                                                            DlgListBoxArray "ListBox1", tempListbox1()

                                                            tempListSelect2 = 0 'set to 1st items as default

                                                            ExitFilesMenu = False

                                                           

                                             Case "btnAddAll"                                           

                                                            ReDim tempListBox2(UBound(dblist))

                                                            ReDim tempListbox1(0)

                                                           

                                                            For i = 0 To UBound(dblist)

                                                                           If dblist(i) <> "-" Then

                                                                                          tempListBox2(i) = dblist(i)

                                                                           End If

                                                            Next i

                                                                                                        

                                                            'Call sortArray(tempListBox2)

                                                            Call removeBlanksFromArray(2)

                                                           

                                                            DlgListBoxArray "ListBox2", tempListBox2()

                                                            DlgListBoxArray "ListBox1", tempListbox1()

                                                            ExitFilesMenu = False

                                                           

                                             Case "btnRemoveAll"

                                                            ReDim tempListbox1(UBound(dblist))

                                                            ReDim tempListBox2(0)

                                                            'For i = 0 To UBound(dblist)

                                                            '              tempListbox1(i) = dblist(i)

                                                            'Next i

                                                           

 

                                                            For i = 0 To UBound(dblist)                                                                                                                   

                                                                           If Left(dblist(i),18) = "Current database (" Then

                                                                                          tempcurrdb2 = "--" & Mid(dblist(i), 19, Len(dblist(i)) - 18 - 1)

                                                                                           tempListbox1(i) = tempcurrdb2                                                                           

                                                                           Else

                                                                                          tempcurrdb2 = ""

                                                                           End If                                                                                                            

                                                                           If dblist(i) <> "-" And dblist(i) <> tempcurrdb And i <> 0 Then

                                                                                           tempListbox1(i) = dblist(i)           

                                                                           End If

                                                            Next i

                                            

                                                            Call sortArray(tempListbox1)

                                                            Call removeBlanksFromArray(1)

                                                            DlgListBoxArray "ListBox2", tempListBox2()

                                                            DlgListBoxArray "ListBox1", tempListbox1()

                                                            ExitFilesMenu = False

                                                           

                                             Case "ListBox1"

                                                            tempListSelect1 = SuppValue

                                            

                                             Case "ListBox2"

                                                            tempListSelect2 = SuppValue

                                            

                                             Case "btnok"

                                                            If tempListBox2(0) = "" Or tempListBox2(0) = "-" Then

                                                                           If GUILanguage = "EN" Then

                                                                                          MsgBox "Please select at least one item"

                                                                                          Else

                                                                                          MsgBox "Veuillez sélectionner au moins un item."                                                                              

                                                                           End If

                                                                           ExitFilesMenu = False

                                                            Else

                                                                          

                                                                           ExitFilesMenu = True

                                                                           ReDim Selecteddblist(UBound(tempListbox2))

                                                                           'ReDim UBound(dblist2) & vbcrlf &

                                                                           'Selecteddblist=tempListbox2

                                                                                                                                                     

                                                                           For i = 0 To UBound(tempListBox2)

                                                                                          'MsgBox tempListBox2(i)

                                                                                          Selecteddblist(i) = tempListBox2(i)

                                                                                          'MsgBox Selecteddblist(i)            

                                                                           Next i

                                                                          

                                                                           If Left(Selecteddblist(0) ,2) = "--" Then

                                                                                          Selecteddblist(0) = Mid(Selecteddblist(0) , 3)

                                                                           End If

 

 

                                                            End If

                                                           

                                                            Case "btnCancel"

                                                                           ReDim tempListbox1(0)

                                                                           ReDim tempListbox2(0)

                                                                           ReDim Selecteddblist(0)

                              End Select

 

                             

               End Select

 

 

               If tempListbox1(0) = "" Then 'firt list box is emtpy

                              DlgEnable "btnAddOne", 0

                              DlgEnable "btnAddAll", 0                            

                              DlgEnable "btnRemoveOne", 1

                              DlgEnable "btnRemoveAll", 1

 

               ElseIf tempListBox2(0) = "" Then 'second list box is empty

                              DlgEnable "btnAddOne", 1

                              DlgEnable "btnAddAll", 1

                              DlgEnable "btnRemoveOne", 0

                              DlgEnable "btnRemoveAll", 0

              

               Else 'something in boxes

                              DlgEnable "btnAddOne", 1

                              DlgEnable "btnAddAll", 1

                              DlgEnable "btnRemoveOne", 1

                              DlgEnable "btnRemoveAll", 1                    

               End If   

 

              

              

               If ExitFilesMenu Then

                              dlgChooseFIlesDisplay = 0

               Else

                              dlgChooseFIlesDisplay = 1

               End If

              

              

End Function

' ================================================================================

 

 

' ================================================================================

Function dlgChooseFieldsDisplay(ControlID$, Action%, SuppValue%)        

'****************************************************************************************************

'   Name:              dlgChooseFieldsDisplay

'   Description:    Routine to control the select fields dialog

' Credits: unkown

'****************************************************************************************************

               Dim i As Double

               Dim j As Double

               Dim k As Double

               Dim l As Double 'used to update fieldstempListbox1 and 2 array

               Dim bListBox2Set As Boolean 'flag to show item was in placed in listbox2

              

               Dim arraytoUse() As String

               ReDim arraytoUse(UBound(allfields))

               arraytoUse=allfields

              

               Select Case Action

                              Case 1

                              'initialize the variables

                              If GUILanguage = "EN" Then

                                             dlgtext "txtTitle", "Select Items to include"

                                             dlgtext "lblNoPick","Pick List (these items will NOT be added to the selection):"

                                             dlgtext "lblPick","Pick List (these items will be added to the selection):"

                                             dlgtext "btnSearch","> Add based on search"

                                             Else

                                             dlgtext "txtTitle", "Choisir des items à inclure"

                                             dlgtext "lblNoPick","Liste de sélection (ces items ne seront PAS inclus à la sélection)"

                                             dlgtext "lblPick","Liste des items choisis (ces items seront ajoutés à la sélection)"

                                             dlgtext "btnSearch","> Ajouter selon une recherche"

                                             dlgtext "btnCancel","Annuler"                                                                               

                              End If

                              l = 0

                              k = 0                                                  

                             

                              If UBound(fieldstempListbox1) = 0 And UBound(fieldstempListbox2) = 0Then

                                             ReDim fieldstempListbox1(UBound(arraytoUse)-1 )          'to skip the "-" value

                                             ReDim fieldstempListbox2(0)      

                                            

                                             For i = 1 To UBound(arraytoUse)               

                                                                           fieldstempListbox1(i-1)  = arraytoUse(i)                                

                                             Next i

                              End If

                              Call sortArray(tempListbox1)

                              Call removeBlanksFromFieldsArray(1)

                              Call removeBlanksFromFieldsArray(2)                                   

 

                                                           

                              DlgListBoxArray "fieldsListBox1", fieldstempListbox1        

                              DlgListBoxArray "fieldsListBox2", fieldstempListbox2

                              tempListSelect1 = 0  'set to 1st items as default

                             

                              Case 2

                              Select Case ControlID

                                             Case "btnSearch"

                                                            SearchString = dlgtext("txtSearch")

                                                            ReDim SearchArray(0)

                                                            SearchArray(0)=SearchString                                                   

                                                           

                                                            SearchForMatchesFields

                                                           

                                                            Call removeBlanksFromFieldsArray(1)

                                                            Call removeBlanksFromFieldsArray(2)

                                                                                                                       

                                                            DlgListBoxArray "fieldsListBox2", fieldstempListBox2()

                                                            DlgListBoxArray "fieldsListBox1", fieldstempListbox1()                                   

                                                                                                                                                                                                                                               

                                             Case "btnAddOne"          

                                                            ReDim Preserve fieldstempListBox2(UBound(fieldstempListBox2) + 1)

                                                           

                                                            fieldstempListBox2(UBound(fieldstempListBox2)) = fieldstempListbox1(fieldstempListSelect1)

 

                                                            fieldstempListbox1(fieldstempListSelect1) = ""

                                                           

                                                            Call sortArray(fieldstempListbox1)

                                                            'Call sortArray(fieldstempListBox2)

                                                            Call removeBlanksFromFieldsArray(1)

                                                            Call removeBlanksFromFieldsArray(2)

 

                                                            DlgListBoxArray "fieldsListBox2", fieldstempListBox2()

                                                            DlgListBoxArray "fieldsListBox1", fieldstempListbox1()

                                                            fieldstempListSelect1 = 0 'set to 1st items as default

                                                            ExitFieldsMenu = False

 

                                             Case "btnRemoveOne"

                                                            ReDim Preserve fieldstempListbox1(UBound(fieldstempListbox1) + 1)

                                                           

                                                            fieldstempListbox1(UBound(fieldstempListbox1)) = fieldstempListBox2(fieldstempListSelect2)

                                                           

                                                            fieldstempListBox2(fieldstempListSelect2) = ""

                                                           

                                                            Call sortArray(fieldstempListbox1)

                                                            'Call sortArray(fieldstempListBox2)

                                                            Call removeBlanksFromFieldsArray(1)

                                                            Call removeBlanksFromFieldsArray(2)

 

                                                            DlgListBoxArray "fieldsListBox2", fieldstempListBox2()                                                  

                                                            DlgListBoxArray "fieldsListBox1", fieldstempListbox1()

                                                            fieldstempListSelect2 = 0 'set to 1st items as default

                                                            ExitFieldsMenu = False

                                                           

                                             Case "btnAddAll"                                           

                                                            ReDim fieldstempListbox2(UBound(arraytoUse)-1 )          'to skip the "-" value

                                                            ReDim fieldstempListbox1(0)      

                                                           

                                                            For i = 1 To UBound(arraytoUse)               

                                                                                          fieldstempListbox2(i-1)  = arraytoUse(i)                                

                                                            Next i

                                                                                                        

                                                            'Call sortArray(fieldstempListBox2)

                                                            Call removeBlanksFromFieldsArray(2)

                                                           

                                                            DlgListBoxArray "fieldsListBox2", fieldstempListBox2()

                                                            DlgListBoxArray "fieldsListBox1", fieldstempListbox1()

                                                            ExitFieldsMenu = False

                                                           

                                             Case "btnRemoveAll"

                                                            ReDim fieldstempListbox1(UBound(arraytoUse)-1 )          'to skip the "-" value

                                                            ReDim fieldstempListbox2(0)      

                                                           

                                                            For i = 1 To UBound(arraytoUse)               

                                                                                          fieldstempListbox1(i-1)  = arraytoUse(i)                                

                                                            Next i

                                                           

                                                            Call sortArray(fieldstempListbox1)

                                                            Call removeBlanksFromFieldsArray(1)

                                                            Call removeBlanksFromFieldsArray(2)                                                  

                                                            DlgListBoxArray "fieldsListBox2", fieldstempListBox2()

                                                            DlgListBoxArray "fieldsListBox1", fieldstempListbox1()

                                                            ExitFieldsMenu = False

                                                           

                                             Case "fieldsListBox1"

                                                            fieldstempListSelect1 = SuppValue

                                            

                                             Case "fieldsListBox2"

                                                            fieldstempListSelect2 = SuppValue

                                            

                                             Case "btnok"                                                                                                                                            

                                                            If fieldstempListBox2(0) = "" Or fieldstempListBox2(0) = "-" Then

                                                                           If GUILanguage = "EN" Then

                                                                                          MsgBox "Please select at least one item"

                                                                                          Else

                                                                                          MsgBox "Veuillez sélectionner au moins un item."                                                                              

                                                                           End If

                                                                           ExitFieldsMenu = False

                                                            Else

                                                                          

                                                                           ExitFieldsMenu = True

                                                                           ReDim SelectedFieldslist(UBound(fieldstempListbox2))

                                                                           'ReDim UBound(dblist2) & vbcrlf &

                                                                           'Selecteddblist=fieldstempListbox2

                                                                                                                                                     

                                                                           For i = 0 To UBound(fieldstempListBox2)

                                                                                          'MsgBox fieldstempListBox2(i)

                                                                                          SelectedFieldslist(i) = fieldstempListBox2(i)

                                                                                          'MsgBox Selecteddblist(i)            

                                                                           Next i

                                                                          

                                                                           If Left(SelectedFieldslist(0) ,2) = "--" Then

                                                                                          SelectedFieldslist(0) = Mid(SelectedFieldslist(0) , 3)

                                                                           End If

 

 

                                                            End If

                                                           

                                             Case "btnCancel"

                                                            ReDim fieldstempListbox1(0)

                                                            ReDim fieldstempListbox2(0)

                                                            ReDim SelectedFieldslist(0)

                                                           

                                             'Case "txtSearchField"

                                             '              searchFieldName=dlgtext("txtSearchField")

                              End Select

 

                             

               End Select

 

 

               DlgEnable "btnAddOne", 1

               DlgEnable "btnAddAll", 1

               DlgEnable "btnRemoveOne", 1

               DlgEnable "btnRemoveAll", 1                    

              

               If UBound(fieldstempListbox1) = 0 And fieldstempListbox1(0) = "" Then 'add list box is emtpy

                              DlgEnable "btnAddOne", 0

                              DlgEnable "btnAddAll", 0

               End If

              

               If UBound(fieldstempListbox2) = 0 And fieldstempListBox2(0) = "" Then 'remove list box is empty

                              DlgEnable "btnRemoveOne", 0

                              DlgEnable "btnRemoveAll", 0

               End If

                             

              

               If ExitFieldsMenu Then

                              dlgChooseFieldsDisplay = 0

               Else

                              dlgChooseFieldsDisplay = 1

               End If

              

              

End Function

' ================================================================================

 

 

 

' ================================================================================

Private Function removeBlanksFromFieldsArray(tempType As Double)

'****************************************************************************************************

'   Name:              removeBlanksFromArray

'   Description:    Routine to remove blank entries to an array

'   Last Update:

'****************************************************************************************************

               Dim tempArray() As String

               Dim i, ILoop As Double

               ReDim tempArray(0)

                             

               If tempType = 1 Then

                              For ILoop = 0 To UBound(FieldstempListbox1)

                                             If FieldstempListbox1(ILoop) <> "" Then

                                                            tempArray(UBound(tempArray)) = FieldstempListbox1(ILoop)

                                                            If ILoop <> UBound(FieldstempListbox1) Then 'don't increment on the last pass

                                                                           ReDim Preserve tempArray(UBound(tempArray) + 1)

                                                            End If

                                             End If

                              Next ILoop

                             

                              i = UBound(tempArray)

                              Erase FieldstempListbox1

                             

                              ReDim FieldstempListbox1(i)

                              For ILoop = 0 To UBound(tempArray)

                                             'MsgBox "i " & ILoop & " - " & tempArray(ILoop)

                                             FieldstempListbox1(ILoop) = tempArray(ILoop)

                              Next ILoop

                             

               Else

                              For ILoop = 0 To UBound(FieldstempListbox2)

                                             If FieldstempListbox2(ILoop) <> "" Then

                                                            tempArray(UBound(tempArray)) = FieldstempListbox2(ILoop)

                                                            If ILoop <> UBound(FieldstempListbox2) Then 'don't increment on the last pass

                                                                           ReDim Preserve tempArray(UBound(tempArray) + 1)

                                                            End If

                                             End If

                              Next ILoop

              

                              i = UBound(tempArray)

                              Erase tempListBox2

                             

                              ReDim FieldstempListbox2(i)

                             

                              For ILoop = 0 To UBound(tempArray)

                                             'MsgBox "i " & ILoop & " - " & tempArray(ILoop)

                                             FieldstempListbox2(ILoop) = tempArray(ILoop)

                              Next ILoop

                             

 

               End If

 

End Function

' ================================================================================

 

 

' ================================================================================

Function SearchForMatchesFields

               Dim j As Double

               Dim i As Double

 

               Dim percentComplete As Object

               Set percentComplete = CreateObject ("CommonIdeaControls.StandaloneProgressCtl")

               If GUILanguage = "EN" Then

                              percentComplete.Start "Searching, please wait..."                                                         

                              Else

                              percentComplete.Start "Recherche en cours..."                                               

               End If   

              

               Dim UBoundSearchArray As Double        

               UBoundSearchArray=UBound(SearchArray)

              

               Dim UBoundtempListBox2 As Double

               UBoundtempListBox2=UBound(FieldstempListBox2)

 

               Dim UBoundtempListBox1 As Double

               UBoundtempListBox1=UBound(FieldstempListBox1)

                                            

               Dim tempListbox1i As String

               Dim SearchArrayj As String

              

               Dim TotalSearchLines As Double

               TotalSearchLines = UBoundtempListBox1 * (UBoundSearchArray+1)

               If TotalSearchLines = 0 Then TotalSearchLines = 1

              

               Dim k As Double

               For j = 0 To UBoundSearchArray

                              SearchArrayj=SearchArray(j)        

                              For i = 0 To UBoundtempListBox1

                                             k=k+1                  

                                             percentComplete.Progress Int(k * 100 / TotalSearchLines)

                                             tempListbox1i=FieldstempListbox1(i)

                                             If iisini(SearchArrayj, tempListbox1i) And SearchArrayj<> "" Then

                                                            'MsgBox "tempListbox1(i)" & tempListbox1(i) & vbcrlf &  _

                                                            '"SearchString: "& SearchArray(j)

                                                            UBoundtempListBox2=UBoundtempListBox2+1

                                                            ReDim Preserve FieldstempListBox2(UBoundtempListBox2)

                                                            FieldstempListBox2(UBoundtempListBox2) = tempListbox1i

                                                            FieldstempListbox1(i) = ""

                                             End If

                              Next i

               Next j

              

               Set percentComplete = Nothing

End Function

' ================================================================================

 

 

'credits https://stackoverflow.com/questions/152319/vba-array-sort-function

Function QuickSort(ArrayOfTerms() As String)

               Dim a As Double

               Dim i As Double

               Dim j As Double

               Dim temp$

               Dim uboundArray As Integer

                              For a = UBound(ArrayOfTerms) - 1 To 1  Step -1

                                  For j= 1 To a

                                     If ArrayOfTerms(j)>ArrayOfTerms(j+1) Then

                                          temp=ArrayOfTerms(j+1)

                                          ArrayOfTerms(j+1)=ArrayOfTerms(j)

                                          ArrayOfTerms(j)=temp

                                      End If

                                  Next

                              Next

End Function

 

' file select dialog

Function  BrowseForFile As String

'credits: Todd Higgins

               Dim filebar As Object

               Dim sf As String, FilePath As String

              

               Set filebar = CreateObject ("ideaex.FileExplorer")

               ' Display the File Explorer

               filebar.DisplayDialog

               ' Set Variable to store Select File Name

 

               sf = filebar.SelectedFile

               If Len(sf) > 0 Then

                              BrowseForFile =  sf

                             Else

                              BrowseForFile =               ""

               End If

 

               Set filebar = Nothing

                

End Function     

 

' ================================================================================

Private Function sortArray(MyArray() As String)

'****************************************************************************************************

'   Name:              sortArray

'   Description:    Routine to sort an array

'   Last Update:

'   Accepts:                         A one dimensional array

'   Returns:                          Same array sorted

'****************************************************************************************************

               Dim lLoop As Double

               Dim lLoop2 As Double

               Dim str1 As String

               Dim str2 As String

 

               Dim UBoundMyArray As Double

               UBoundMyArray=UBound(MyArray)

               If UBoundMyArray = 0 Then UBoundMyArray = 1

              

               Dim percentComplete As Object

               Set percentComplete = CreateObject ("CommonIdeaControls.StandaloneProgressCtl")

               If GUILanguage = "EN" Then

                              percentComplete.Start "Updating list box..."                                                    

                              Else

                              percentComplete.Start "Mise à jour de la liste..."                                                           

               End If                  

              

               For lLoop = 0 To UBound(MyArray)

                              percentComplete.Progress Int(lLoop * 100 / UBoundMyArray)

                                            

                              For lLoop2 = lLoop To UBound(MyArray)

                                            

                                             If UCase(MyArray(lLoop2)) < UCase(MyArray(lLoop)) Then

                                                           

                                                            str1 = MyArray(lLoop)

                                                            str2 = MyArray(lLoop2)

                                                            MyArray(lLoop) = str2

                                                            MyArray(lLoop2) = str1

                                                           

                                             End If

                                            

                              Next lLoop2

                             

               Next lLoop

              

               Set percentComplete = Nothing

End Function

' ================================================================================

 

 

' ================================================================================

Private Function removeBlanksFromArray(tempType As Double)

'****************************************************************************************************

'   Name:              removeBlanksFromArray

'   Description:    Routine to remove blank entries to an array

'   Last Update:

'****************************************************************************************************

               Dim tempArray() As String

               Dim i, ILoop As Double

               ReDim tempArray(0)

                             

               If tempType = 1 Then

                              For ILoop = 0 To UBound(tempListbox1)

                                             If tempListbox1(ILoop) <> "" Then

                                                            tempArray(UBound(tempArray)) = tempListbox1(ILoop)

                                                            If ILoop <> UBound(tempListbox1) Then 'don't increment on the last pass

                                                                           ReDim Preserve tempArray(UBound(tempArray) + 1)

                                                            End If

                                             End If

                              Next ILoop

                             

                              i = UBound(tempArray)

                              Erase tempListbox1

                             

                              ReDim tempListbox1(i)

                              For ILoop = 0 To UBound(tempArray)

                                             'MsgBox "i " & ILoop & " - " & tempArray(ILoop)

                                             tempListbox1(ILoop) = tempArray(ILoop)

                              Next ILoop

                             

               Else

                              For ILoop = 0 To UBound(tempListBox2)

                                             If tempListBox2(ILoop) <> "" Then

                                                            tempArray(UBound(tempArray)) = tempListBox2(ILoop)

                                                            If ILoop <> UBound(tempListBox2) Then 'don't increment on the last pass

                                                                           ReDim Preserve tempArray(UBound(tempArray) + 1)

                                                            End If

                                             End If

                              Next ILoop

              

                              i = UBound(tempArray)

                              Erase tempListBox2

                             

                              ReDim tempListBox2(i)

                             

                              For ILoop = 0 To UBound(tempArray)

                                             'MsgBox "i " & ILoop & " - " & tempArray(ILoop)

                                             tempListBox2(ILoop) = tempArray(ILoop)

                              Next ILoop

                             

 

               End If

 

End Function

' ================================================================================

 

 

' ================================================================================

Function SearchForMatches

               Dim j As Double

               Dim i As Double

 

               Dim percentComplete As Object

               Set percentComplete = CreateObject ("CommonIdeaControls.StandaloneProgressCtl")

               If GUILanguage = "EN" Then

                              percentComplete.Start "Searching, please wait..."                                                         

                              Else

                              percentComplete.Start "Recherche en cours..."                                               

               End If   

              

               Dim UBoundSearchArray As Double        

               UBoundSearchArray=UBound(SearchArray)

              

               Dim UBoundtempListBox2 As Double

               UBoundtempListBox2=UBound(tempListBox2)

 

               Dim UBoundtempListBox1 As Double

               UBoundtempListBox1=UBound(tempListBox1)

                                            

               Dim tempListbox1i As String

               Dim SearchArrayj As String

              

               Dim TotalSearchLines As Double

               TotalSearchLines = UBoundtempListBox1 * (UBoundSearchArray+1)

               If TotalSearchLines = 0 Then TotalSearchLines = 1

 

               Dim k As Double

               For j = 0 To UBoundSearchArray

                              SearchArrayj=SearchArray(j)        

                              For i = 0 To UBoundtempListBox1

                                             k=k+1                  

                                             On Error Resume Next

                                             err.clear

                                             percentComplete.Progress Int(k * 100 / TotalSearchLines)

                                             If err.number <> 0 Then

                                                            Set percentComplete = Nothing

                                             End If

                                             tempListbox1i=tempListbox1(i)

                                             If iisini(SearchArrayj, tempListbox1i) And SearchArrayj<> "" Then

                                                            'MsgBox "tempListbox1(i)" & tempListbox1(i) & vbcrlf &  _

                                                            '"SearchString: "& SearchArray(j)

                                                            UBoundtempListBox2=UBoundtempListBox2+1

                                                            ReDim Preserve tempListBox2(UBoundtempListBox2)

                                                            tempListBox2(UBoundtempListBox2) = tempListbox1i

                                                            tempListbox1(i) = ""

                                             End If

                              Next i

               Next j

              

               Set percentComplete = Nothing

End Function

' ================================================================================

 

 

 

Je# template

 

Dim Numericfields() AS string

Dim Numericfields2() AS string

Dim Numericfields3() AS string

Dim Numericfields4() AS string

Dim Numericfields5() AS string

Dim Numericfields6() AS string

Dim Numericfields7() AS string

Dim temp() AS string

 

Begin Dialog ChooseField 14,75,300,139," ", .DisplayChooseField

  DropListBox 9,54,248,11, Numericfields(), .DropDown_1

  OKButton 139,85,50,11, "OK", .OKButton1

  CancelButton 208,85,50,12, "Cancel", .CancelButton1

  Text 7,25,242,24, "Choose field to calculate running balance based on.  For example, the ""AMOUNT"" field:", .txt8

  PushButton 9,85,50,10, "Back", .PushButton1

  Text 2,0,281,13, "Choose Running Balance Field", .txtTitleChooseField

End Dialog

 

Begin Dialog ChooseIndex 54,61,266,289," ", .DisplayChooseIndex

  DropListBox 13,39,175,48, Numericfields2(), .DropDown_2

  DropListBox 13,69,175,15, Numericfields3(), .DropDown_3

  Text 13,24,228,13, "Choose first field to index by:", .txt2

  Text 13,55,228,12, "Choose second field to index by (if applicable):", .txt3

  DropListBox 13,100,175,15, Numericfields4(), .DropDown_4

  Text 13,86,224,12, "Choose third field to index by (if applicable):", .txt4

  DropListBox 13,131,175,15, Numericfields5(), .DropDown_5

  Text 13,117,227,13, "Choose fourth field to index by (if applicable):", .txt5

  DropListBox 13,161,175,15, Numericfields6(), .DropDown_6

  Text 13,146,227,12, "Choose fifth field to index by (if applicable):", .txt6

  DropListBox 13,194,175,15, Numericfields7(), .DropDown_7

  Text 13,178,228,12, "Choose sixth field to index by (if applicable):", .txt7

  PushButton 14,243,50,12, "Back", .PushButton1

  CancelButton 188,243,50,12, "Cancel", .CancelButton1

  OKButton 128,243,50,12, "OK", .OKButton1

  Text 0,0,245,13, "Choose Index Field(s)", .txtTitleIndexField

End Dialog

 

Begin Dialog SelectDatabase 40,88,367,146," ", .DisplaySelectDatabase

  DropListBox 13,71,257,11, temp(), .DropListBox1

  OKButton 213,95,50,12, "OK", .OKButton1

  CancelButton 278,95,50,12, "Cancel", .CancelButton1

  Text 11,39,285,24, "Select GL database where to add ECAS journal entry.", .txt1

  PushButton 273,3,25,14, "FR", .btnlng

  Text 2,0,255,14, "ECAS Journal Entry Number Script", .txtTitleSelectDatabase

  PushButton 302,3,40,14, "Help", .btnHelp

End Dialog

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

' Author: Avinash Chandra, Edmonton TSO, 780-495-5108             

 

' Date: June 8, 2011

 

' Purpose: Add ECAS created Journal Entry Number in GL based on a sequential database Running Balance

 

' Background      :              Parts of this script is copied from the "Accumbreak.iss" script by Joel J.J. Hebert dated 08/06/2002. 

'                                            Some GL databases do not contain a journal entry number.  In these cases, the entries in the GL

'                                            may be sorted In posting order (i.e. debit entry/entries followed by corresponding credit entry/entries).

'                                            This script will create a new GL database indexed based on the chosen fields (up to six).

'                                            A running balance field (“RUNNING_BAL”) is then created from the net amount field based on the new index.

'                                            A new field (ECAS_JE_NUM) is created that assigns a unique journal entry number

'                                            for each set of records where the entry In “RUNNING_BAL” field is zero (i.e. debits less credits equals zero).

'                                           

'                                            Some examples are as follow:

'                                           

'                                            SAP can be indexed by "Document Number" and "Line Item"

'                                            ACCPAC can be indexed by "BATCHNBR", "ENTRYNBR", and then "JNLDTLREF"

'                                            ACCPAC can be indexed by "POSTINGSEQ" and then "CNTDETAIL".

'                                            Open Systems can be indexed by "Entry Number"

'                                            AIMS can be indexed by "BATCH" and then "JOUR_REF"

'

'

' Disclaimer         :              This script is provided as is without any warranties.

'                                            If you make any changes to this script, I would ask that you please share them with me (avinash.chandra@cra-arc.gc.ca)

 

' Translation: Jean-François Gauthier (JFG), EQTSO, 2022-01-10

' Update Feb 7, 2022: resized interface to allow text scaling up to 150%.

' Nom français: Création de numéro d'écriture SVI

' But: Ce script prend un champ clé et si un autre champ est rempli une seule fois à travers plusieurs transactions, il va créer un champ et remplir toutes les transactions avec l'information trouvée. Le numéro d'écriture est incrémenté à chaque fois que cette balance atteint 0.

' ActiveDatabase:             False

' UserType:CAS

' ScriptLanguage:BILINGUAL

' ________________________________________________________________________________________________________________________________________________________________________________

 

'added by JFG for translation

Dim IdeaLanguage As String

Dim GUILanguage As String

 

Sub Main

              

' Variable declarations

              

' Database objects needed from active DB

 

               Dim task                                                           As Object                                                                                                                                                                   'Task for creation of database history

               Dim oldDB                                                        As Object                                                                                                                                                                   'Old Database  object

               Dim oldTable                                                   As Object                                                                                                                                                                   'Old Tabledef  object

               Dim oldRS                                                        As Object                                                                                                                                                                   'Old Recordset object

               Dim oldRec                                                      As Object                                                                                                                                                                   'Old Record    object

               Dim oldField                                                    As Object                                                                                                                                                                   'Old Field     object

              

' Database objects needed to create the new DB

 

               Dim newDB                                                      As Object                                                                                                                                                                   'New Database  object

               Dim newDBName                                           As String                                                                                                                                                                    'New Databse   name

               Dim newDBDesc                                                            As String                                                                                                                                                                    'New Database  description 

               Dim newTable                                                 As Object                                                                                                                                                                   'New Tabledef  object

               Dim newRec                                                    As Object                                                                                                                                                                   'New Record    object

               Dim newRS                                                      As Object                                                                                                                                                                   'New Recordset object

              

' Declarations for the File Explorer and Progress bar

 

               Dim percentComplete                                   As Object                                                                                                                                                                   'Progress bar object                                                                                                                

               Dim filename                                                   As String                                                                                                                                                                    'Name of file selected in File Explorer

               Dim filebar                                                       As Object                                                                                                                                                                   'File Explorer object

 

' Declare variable regarding the Select Database dialog box

 

               Dim pm                                                             As Object

               Dim coll                                                            As Object

               Dim numofdb                                                 As Integer

              

              

               Dim extDB                                                        As Object                                                                                                                                                                   'Object to open newly created Database

               Dim fld                                                              As Object                                                                                                                                                                   'Add a field to the new table def object

               Dim n                                                                As Long                                                                                                                                                                      'Loop subscript

               Dim i                                                                  As Long                                                                                                                                                                      'Loop subscript

               Dim numval                                                     As Double                                                                                                                                                                  'Value to transfer from old DB to new DB

               Dim charval                                                     As String                                                                                                                                                                    'IBID

              

               Dim Fieldtype()                                                As String

               Dim Ftype                                                         As String

               Dim total                                                          As Double                                                                                                                                                                  'Variable to hold cummulative values

               Dim NumFields                                                As Integer                                                                                                                                                                 'Number of fields in the table

               Dim j                                                                  As Integer                                                                                                                                                                 'Value of the listbox selection

               Dim ThisFieldName                                        As String                                                                                                                                                                    'Name of the field

               Dim ThisField                                                   As String

               Dim Button                                                      As Integer

               Dim Button2                                                    As Integer

               Dim SelectField                                               As String                                                                                                                                                                    'Name of the field selected in the first Dialog

               Dim SelectField2                                                            As String

               Dim SelectField3                                                            As String

               Dim SelectField4                                                            As String

               Dim SelectField5                                                            As String             

               Dim SelectField6                                                            As String

               Dim SelectField7                                                            As String             

               Dim amtField                                                   As Double

               Dim dblNumstrat                                                           As Double

               Dim dblNumcalc                                                            As Double

               Dim strField                                                     As String

               Dim selectfld                                                   As String

              

                             

               'On Error GoTo errHandler

              

'**********************Main Logic*******************************

               getSettings 'added by JFG for translation

              

ChooseDatabase:

              

' Access project management object to manage databases/projects on server

 

               Set pm = Client.ProjectManagement

 

' Set the coll object to be the databases within the current project

              

               Set coll = pm.Databases

              

' Get total count of databases

              

               numofdb = coll.count

 

               ReDim temp(numofdb+1)

 

               temp(0) = "Current Open (Active) Database"

               If guilanguage = "FR" Then temp(0)  = "Base de données courante"           

              

' Iterate throught the coll to get the database names

 

               For i = 1 To coll.count

                              temp(i) = coll.getAt(i-1)

               Next i

 

' Display the list of databases

 

               Dim Dlg1 As SelectDatabase

               Do

                              Button = Dialog(Dlg1)

                              ' Current Open Database Selection and Open the database

                              If Button = -1 Then

                                             ' If user chooses OK then capture field choice

                                             i =  SelectDatabase.DropListBox1

                                             filename = temp(i)

                                                            If filename = "Current Open (Active) Database" Or filename = "Base de données courante"Then

                                                                           On Error Resume Next

                                                                           filename = ireplace(client.currentdatabase.name,client.workingdirectory,"")

                                                                           If err.number <> 0 Then

                                                                                          filename = ""

                                                                           Else

                                                                                          Set olddb = client.currentdatabase

                                                                           End If                                 

                                                                           On Error GoTo 0

                                                            Else

                                                                           Set olddb = client.opendatabase(filename)                                                                                                                     'Open file that was selected in the file explorer

                                                            End If

                              Else

                                             Exit Sub

                              End If

               Loop Until button <> -1 Or filename <> ""

              

              

 

 

' Set variables

              

               total = 0                                                                                                                                                                                                                                                'Set our cummulative value to 0

 

' Create a table of field names

              

               Set table = olddb.tabledef

               Numfields = table.count

               ReDim NumericFields(NumFields)

               ReDim NumericFields2(NumFields)

               ReDim NumericFields3(NumFields+1)

               ReDim NumericFields4(NumFields+1)

               ReDim NumericFields5(NumFields+1)

               ReDim NumericFields6(NumFields+1)

               ReDim NumericFields7(NumFields+1)

               ReDim FieldType(NumFields)

 

'**********************End Main Logic*******************************

              

'****************DIALOG 1***********************************************

 

ChooseAmountField:

 

j=0

               For i = 1 To numfields

                              Set ThisField = Table.GetFieldAt (i)

                              If ThisField.IsNumeric Then                                                                                                                                                                ' If the field is numeric put it in the listbox

                                             ThisFieldName = ThisField.Name

                                             Numericfields(j) = ThisFieldName                                                                                                                       'Set value for AllFields array

                                             j=j+1

                              End If

               Next i

 

 

' Dialog Box to let user pick the field to be accumulated

 

               Dim Dlg2 As ChooseField

               Button1 = Dialog(Dlg2)

              

' If user chooses OK then capture field choice

              

               If Button1 = -1 Then

                              j =  ChooseField.DropDown_1

                              SelectField = Numericfields(j)

               ElseIf Button1 = 1 Then

                              GoTo ChooseDatabase

               Else

                              Exit Sub

               End If

 

'**********************END DIALOG 1*************************************

 

 

'**********************DIALOG 2******************************************

ChooseIndexFields:

 

j=0

               For i = 1 To numfields

                              Set ThisField = Table.GetFieldAt (i)

'                   If Not(ThisField.IsVirtual) Then                                                                          ' If the field is Virtual  do not put it in the listbox

                                             ThisFieldName     = ThisField.Name

                                             ftype             = Thisfield.type

                                             Fieldtype(j)      = ftype

                                             Numericfields2(j) = ThisFieldName                           'Set value for AllFields array

                                             j=j+1

'                               End If

               Next i

 

If guilanguage = "EN" Then

               Numericfields3(0) = "NOT APPLICABLE"

Else

               Numericfields3(0) = "NON APPLICABLE"

End If

 

 j=1

               For i = 1 To numfields

                              Set ThisField = Table.GetFieldAt (i)

'                   If Not(ThisField.IsVirtual) Then                                                                          ' If the field is Virtual  do not put it in the listbox

                                             ThisFieldName     = ThisField.Name

                                             ftype             = Thisfield.type

                                             Fieldtype(j)      = ftype

                                             Numericfields3(j) = ThisFieldName                           'Set value for AllFields array

                                             j=j+1

'                               End If

               Next i

 

               If guilanguage = "EN" Then

                              Numericfields4(0) = "NOT APPLICABLE"

               Else

                              Numericfields4(0) = "NON APPLICABLE"

                             

               End If

              

 

 j=1

               For i = 1 To numfields

                              Set ThisField = Table.GetFieldAt (i)

'                   If Not(ThisField.IsVirtual) Then                                                                          ' If the field is Virtual  do not put it in the listbox

                                             ThisFieldName     = ThisField.Name

                                             ftype             = Thisfield.type

                                             Fieldtype(j)      = ftype

                                             Numericfields4(j) = ThisFieldName                           'Set value for AllFields array

                                             j=j+1

'                               End If

               Next i

 

               If guilanguage = "EN" Then

              

               Else

                             

               End If

              

               If guilanguage = "EN" Then

                              Numericfields5(0) = "NOT APPLICABLE"

               Else

                              Numericfields5(0) = "NON APPLICABLE"

                             

               End If

 j=1

               For i = 1 To numfields

                              Set ThisField = Table.GetFieldAt (i)

'                   If Not(ThisField.IsVirtual) Then                                                                          ' If the field is Virtual  do not put it in the listbox

                                             ThisFieldName     = ThisField.Name

                                             ftype             = Thisfield.type

                                             Fieldtype(j)      = ftype

                                             Numericfields5(j) = ThisFieldName                           'Set value for AllFields array

                                             j=j+1

'                               End If

               Next i

              

               If guilanguage = "EN" Then

                              Numericfields6(0) = "NOT APPLICABLE"

               Else

                              Numericfields6(0) = "NON APPLICABLE"

                             

               End If

 j=1

               For i = 1 To numfields

                              Set ThisField = Table.GetFieldAt (i)

'                   If Not(ThisField.IsVirtual) Then                                                                          ' If the field is Virtual  do not put it in the listbox

                                             ThisFieldName     = ThisField.Name

                                             ftype             = Thisfield.type

                                             Fieldtype(j)      = ftype

                                             Numericfields6(j) = ThisFieldName                           'Set value for AllFields array

                                             j=j+1

'                               End If

               Next i

 

               If guilanguage = "EN" Then

                              Numericfields7(0) = "NOT APPLICABLE"

               Else

                              Numericfields7(0) = "NON APPLICABLE"

                             

               End If

 j=1

               For i = 1 To numfields

                              Set ThisField = Table.GetFieldAt (i)

'                   If Not(ThisField.IsVirtual) Then                                                                          ' If the field is Virtual  do not put it in the listbox

                                             ThisFieldName     = ThisField.Name

                                             ftype             = Thisfield.type

                                             Fieldtype(j)      = ftype

                                             Numericfields7(j) = ThisFieldName                           'Set value for AllFields array

                                             j=j+1

'                               End If

               Next i

                             

' Dialog Box to let user pick the field to be accumulated

 

               Dim Dlg3 As ChooseIndex

               Button2 = Dialog(Dlg3)

              

' If user chooses OK then capture field choice

 

               If Button2 = -1 Then

                              j =  ChooseIndex.DropDown_2

                              SelectField2 = Numericfields2(j)

                              j =  ChooseIndex.DropDown_3

                              SelectField3 = Numericfields3(j)

                              j =  ChooseIndex.DropDown_4

                              SelectField4 = Numericfields4(j)

                              j =  ChooseIndex.DropDown_5

                              SelectField5 = Numericfields5(j)

                              j =  ChooseIndex.DropDown_6

                              SelectField6 = Numericfields6(j)

                              j =  ChooseIndex.DropDown_7

                              SelectField7 = Numericfields7(j)

 

               ElseIf Button2 = 1 Then

                              GoTo ChooseAmountField

               Else

                              Exit Sub

               End If

 

'*************************END DIALOG 2*****************************

 

' Get Index fields

 

               Dim IndexFields As String

              

               IndexFields = SelectField2 & ", " & SelectField3 & ", " & SelectField4 & ", " & SelectField5 & ", " & SelectField6 & ", " & SelectField7

 

               If guilanguage = "EN" Then

                              IndexFields = ireplace(IndexFields ,", NOT APPLICABLE" ,"")          

               Else

                              IndexFields = ireplace(IndexFields ,", NON APPLICABLE" ,"")         

               End If

 

 

' Create the new database

               Set task = oldDB.Extraction

               task.IncludeAllFields

               newDBName                     = ireplace(filename,".IMD"," Index - " & IndexFields & ".IMD")

               newDBName                     = Client.UniqueFileName(newDBName)

              

 

              

' Set database index

If guilanguage = "EN" Then         

               If SelectField2 <> "NOT APPLICABLE" Then

               task.AddKey SelectField2, "A"

               End If

              

               If SelectField3 <> "NOT APPLICABLE" Then

               task.AddKey SelectField3, "A"

               End If

 

               If SelectField4 <> "NOT APPLICABLE" Then

               task.AddKey SelectField4, "A"

               End If

 

               If SelectField5 <> "NOT APPLICABLE" Then

               task.AddKey SelectField5, "A"

               End If

 

               If SelectField6 <> "NOT APPLICABLE" Then

               task.AddKey SelectField6, "A"

               End If

 

               If SelectField7 <> "NOT APPLICABLE" Then

               task.AddKey SelectField7, "A"

               End If

                             

Else

              

               If SelectField2 <> "NON APPLICABLE" Then

               task.AddKey SelectField2, "A"

               End If

              

               If SelectField3 <> "NON APPLICABLE" Then

               task.AddKey SelectField3, "A"

               End If

 

               If SelectField4 <> "NON APPLICABLE" Then

               task.AddKey SelectField4, "A"

               End If

 

               If SelectField5 <> "NON APPLICABLE" Then

               task.AddKey SelectField5, "A"

               End If

 

               If SelectField6 <> "NON APPLICABLE" Then

               task.AddKey SelectField6, "A"

               End If

 

               If SelectField7 <> "NON APPLICABLE" Then

               task.AddKey SelectField7, "A"

               End If   

End If

              

               task.AddExtraction newDBName, "", ""                 

               task.PerformTask 1, olddb.Count

               Set task = Nothing

 

               Set newDB           = Client.opendatabase (newDBName )

 

' Add Running Balance field

               Set task = newdb.TableManagement   

               Set newtabledef = newdb.TableDef

               Set fld = newtabledef.NewField  

               fld.Equation = "0"

              

               If guilanguage = "EN" Then

                              fld.Name                            = "Running_Bal"

                              fld.Description   = "Running Balance calculated" 

               Else

                              fld.Name                            = "SOLDE_CUMULATIF"

                              fld.Description   = "Solde cumulatif calculé"

               End If   

 

                   fld.Type                          = WI_EDIT_NUM

                   fld.Decimals                                 = 2

                              task.AppendField fld

                              task.PerformTask

               Set task = Nothing

               Set fld = Nothing

              

' Add ECAS JE Num field

               Set task = newdb.TableManagement   

               Set newtabledef = newdb.TableDef

               Set fld = newtabledef.NewField  

               fld.Equation = "0"

              

               If guilanguage = "EN" Then

                              fld.Name                            = "ECAS_JE_Num"

                              fld.Description                  = "ECAS created Journal Entry Number"                

               Else

                              fld.Name                            = "NO_ÉCRITURE_SVI"

                              fld.Description                  = "Numéro d'écriture créé par le/la SVI"               

                             

               End If   

 

                   fld.Type                          = WI_EDIT_NUM

                   fld.Decimals                                 = 0

                              task.AppendField fld

                              task.PerformTask

               Set task = Nothing          

               Set fld = Nothing

 

 

               Set newdb = Client.OpenDatabase (newDBName)

 

               Set newRS           = newDB.RecordSet

               Set newRec        = newRS.NewRecord     

 

' Creating an instance of a Progress Bar

 

               Set percentComplete = CreateObject ("CommonIdeaControls.StandaloneProgressCtl")

               If guilanguage = "EN" Then

                              percentComplete.Start "Creating new Database"

               Else

                              percentComplete.Start "Création du nouveau fichier"

               End If

              

                             

' Copy each record in the primary database to the new database

              

               newRS.ToFirst

              

               Set newRec        = newRS.ActiveRecord

              

               JE = 1

              

               Dim ans As Integer                                                      

              

               For i = 1 To newDB.Count

              

               percentComplete.Progress Int(i * 100 / newDB.count)

 

 

               ' Move to next record

 

                              newRS.Next

              

                              amtfield = newRec.GetNumValue (SelectField)

                              total = total + amtfield

 

                              If guilanguage = "EN" Then

                                             newRec.SetNumValue "Running_Bal", total

                                            

                                             newRec.SetNumValue "ECAS_JE_Num", JE

                                            

                              Else

                                             newRec.SetNumValue "SOLDE_CUMULATIF", total

                                                           

                                             newRec.SetNumValue "NO_ÉCRITURE_SVI", JE

                                            

                              End If

 

                              'left to help debug

               '              If ans <> IDNO Then

               '                             ans=MsgBox(total & Chr(13) & Chr(10) & JE & Chr(13) & Chr(10) & "Continue display?" , MB_YESNO)

               '              End If

                             

                              newRS.SaveRecord newRec

                             

                              If Round(total,2) = 0.00 Then

                              JE = JE + 1

                              End If

 

              

               Next i

 

 

'  Write out a history entry

              

               Set task = newDB.History()

              

               If guilanguage = "EN" Then

                              task.NewTask "Created New Database"

                              task.AppendDatabaseInfo

                              task.AppendText "Description", "Created new database from GL database.  Added a Running Balance field and ECAS JE Num field."

                              task.AppendText "New field", "Running_Bal and ECAS-JE_Num"

                              task.AppendText "Index Fields", "" & IndexFields & ""

                              task.AppendText "Records Written", olddb.count                            

               Else

                              task.NewTask "Created New Database"

                              task.AppendDatabaseInfo

                              task.AppendText "Description", "Créé une nouvelle base de données à partir du GL. Ajouté les champs 'SOLDE_CUMULATIF'  et 'NO_ÉCRITURE_SVI'."

                              task.AppendText "Nouveau champ", "SOLDE_CUMULATIF et NO_ÉCRITURE_SVI"

                              task.AppendText "Index utilisé(s)", "" & IndexFields & ""

                              task.AppendText "Enregistrements ", olddb.count                           

               End If

              

 

 

               newDB.CommitDataBase

               Set newTable = Nothing

 

               Set extDB                                          = Client.OpenDatabase (newDBName)

 

                               

               Set Table                                           = extDb.TableDef                             

               Table.Protect                                   = True

              

               Set extDB = Nothing

 

GoTo skip

 

              

skip:

' Summarize the GL by ECAS JE Num

               Set db = Client.OpenDatabase (newDBName)

               Set task = db.Summarization

 

               If guilanguage = "EN" Then

                              task.AddFieldToSummarize "ECAS_JE_NUM"

                              task.AddFieldToTotal "" & SelectField & ""

                              newDBName = "KFS JE Num " & filename

                             

               Else

                             

                              task.AddFieldToSummarize "NO_ÉCRITURE_SVI"

                              task.AddFieldToTotal "" & SelectField & ""

                              newDBName = "Total par NO_ÉCRITURE" & filename

               End If

              

               newDBName = Client.UniqueFileName(newDBName)

               task.OutputDBName = newDBName

               task.CreatePercentField = FALSE

               task.StatisticsToInclude = SM_COUNT + SM_SUM

               task.PerformTask

               Set task = Nothing

               Set db = Nothing

 

' Determine if all journal entries equal to zero. 

 

               Set db = Client.opendatabase(newDBName)

              

               Dim SumFieldEndsWith As String

               If idealanguage = "EN" Then

                              SumFieldEndsWith= "_SUM"

               Else

                              SumFieldEndsWith= "_SOMME"

               End If

 

               If guilanguage = "EN" Then

                              If db.FieldStats("" & SelectField & SumFieldEndsWith).NumRecords = db.FieldStats("" & SelectField & SumFieldEndsWith).NumZeroItems Then

                                             button = MsgBox ("All ECAS Journal Entries balance to zero!"  & Chr(13) & _

                                             Chr(13) & _

                                             db.FieldStats("" & SelectField & SumFieldEndsWith).NumRecords & " unique journal entry numbers were created." & Chr(13) & _

                                             Chr(13) & _

                                             "The " & filename & " database was indexed by the following fields:" & Chr(13) & _

                                             Chr(13) & _

                                             " " & ialltrim(ireplace(indexfields,",",Chr(13)))  & Chr(13) & _

                                             Chr(13) & _

                                             "Click on Retry to try another Index or Cancel to Exit the Script.", 69 , "Finished Script")

                              Else                      

                                             button = MsgBox             ("All ECAS Journal Entries DO NOT balance to zero!" & Chr(13) & _

                                             Chr(13) & _

                                             "The " & filename & " database was indexed by the following fields:" & Chr(13) & _

                                             Chr(13) & _

                                             " " & ialltrim(ireplace(indexfields,",",Chr(13)))  & Chr(13) & _

                                             Chr(13) & _

                                             "Click on Retry to try another Index or Cancel to Exit the Script.", 21, "**************   WARNING   **************")

                              End If

              

               Else                      

              

                              If db.FieldStats("" & SelectField & SumFieldEndsWith).NumRecords = db.FieldStats("" & SelectField & SumFieldEndsWith).NumZeroItems Then

                                             button = MsgBox ("Toutes les écritures de journal SVI balancent à zéro!"  & Chr(13) & _

                                             Chr(13) & _

                                             db.FieldStats("" & SelectField & SumFieldEndsWith).NumRecords & " écritures de journal uniques ont été créées. " & Chr(13) & _

                                             Chr(13) & _

                                             "Le fichier " & filename & " a été indexé avec les champs suivants:" & Chr(13) & _

                                             Chr(13) & _

                                             " " & ialltrim(ireplace(indexfields,",",Chr(13)))  & Chr(13) & _

                                             Chr(13) & _

                                             "Cliquez sur 'Réessayer' pour choisir un autre index ou 'Annuler' pour sortir du script.", 69 , "Script terminé")

                              Else

                                             button = MsgBox             ("Les écritures de journal NO_ÉCRITURE_SVI ne balancent PAS toutes à zéro!" & Chr(13) & _

                                             Chr(13) & _

                                             "Le fichier " & filename & " a été indexé avec les champs suivants:" & Chr(13) & _

                                             Chr(13) & _

                                             " " & ialltrim(ireplace(indexfields,",",Chr(13)))  & Chr(13) & _

                                             Chr(13) & _

                                             "Cliquez sur 'Réessayer' pour choisir un autre index ou 'Annuler' pour sortir du script.", 21, "**************   Avertissement   **************")

                              End If                  

               End If

 

              

               If button = 4 Then

               GoTo chooseindexfields

               End If

              

               GoTo ExitScript

              

               errHandler:

              

               Dim errString As String

               If guilanguage = "EN" Then

                              errString="Error"

               Else

                              errString="Erreur"

               End If

              

               If Client.ErrorCode > 0 Then

                              errMsg = errString & ": " & Client.ErrorString

               Else

                              errMsg = errString & "#" & Str(Err.Number) & Chr$(13) & Err.Description & Chr$(13)

               End If

               Response = MsgBox(errMsg, MB_OK, errString )

 

 

               ExitScript:           

                             

' Close All Databases

 

               Client.CloseAll

 

' Refresh File Explorer

 

               Client.RefreshFileExplorer

 

              

' Clear the objects

 

               Set task                                              = Nothing

               Set newDB                                        = Nothing           

               Set newTable                                   = Nothing                                                        

               Set newRec                                      = Nothing                                         

               Set newRS                                        = Nothing

               Set oldDB                                          = Nothing

               Set oldTable                                     = Nothing                                                                                                                                                                 

               Set oldRS                                           = Nothing                                                                                                                                                  

               Set oldRec                                        = Nothing                                                                                                                    

               Set oldField                                      = Nothing           

               Set taskIndex                                    = Nothing

               Set percentComplete                     = Nothing

               Set filebar                                         = Nothing 

               Set pm                                               = Nothing

               Set coll                                               = Nothing

               Set fld                                                = Nothing

               Set ThisField                                     = Nothing

              

               Set db                                                 = Nothing

               Set table                                            = Nothing

               Set extDB                                          = Nothing

              

              

' Reset Working Folder

 

               folder = Client.WorkingDirectory

               Client.WorkingDirectory = folder

 

End Sub

 

 

Function DisplaySelectDatabase(ControlID$, Action%, SuppValue%)

               Select Case Action

                              Case 1                                

                                             UpdateLanguageDisplay

                                             DlgListBoxArray "DropListBox1" , temp

                              Case 2

                                             Select Case controlid

                                                            Case "btnlng"

                                                                           DisplaySelectDatabase=1

                                                                           If guilanguage="EN" Then guilanguage="FR" Else guilanguage="EN"

                                                                           UpdateLanguageDisplay

                                                                           DlgListBoxArray "DropListBox1" , temp

                                                                          

                                                            Case "btnhelp"

                                                                           DisplaySelectDatabase=1

                                                           

                                                                           On Error Resume Next  

                                                                           If GUILanguage = "EN" Then

                                                                                          Client.RunIDEAScriptEx FindLocalLib() & "\Macros.ILB\ISR\Help\ISR Help_External.iss" , "CAS Journal Entry Number",  GUILanguage ,  "" , ""                                                                

                                                                           Else

                                                                                          Client.RunIDEAScriptEx FindLocalLib() & "\Macros.ILB\ISR\Help\ISR Help_External.iss" , "Création de numéro d'écriture SVI",  GUILanguage ,  "" , ""                                                                 

                                                                           End If

                                                                          

                                                                           If err.number <> 0 Then

                                                                                          If GUILanguage = "EN" Then

                                                                                                         MsgBox "Help file not found."

                                                                                          Else

                                                                                                         MsgBox "Le fichier d'aide n'a pas été trouvé."                                                                                  

                                                                                          End If

                                                                           End If

                                                                           On Error GoTo 0

                                             End Select                                        

               End Select

 

End Function

 

Function DisplayChooseField(ControlID$, Action%, SuppValue%)

               Select Case Action

                              Case 1                                

                                             UpdateLanguageDisplay

               End Select

 

End Function

 

Function DisplayChooseIndex(ControlID$, Action%, SuppValue%)

               Select Case Action

                              Case 1                                

                                             UpdateLanguageDisplay

               End Select

 

End Function

 

Sub UpdateLanguageDisplay

               If guilanguage = "EN" Then

                              temp(0) = "Current Open (Active) Database"

                              dlgtext "btnlng", "FR"

                              dlgtext "btnHelp", "Help"

                              dlgtext "txt1", "Select GL database where to add ECAS journal entry."

                              dlgtext "txt2",  "Choose first field to index by:"

                              dlgtext "txt3",  "Choose second field to index by (if applicable):"

                              dlgtext "txt4",  "Choose third field to index by (if applicable):"

                              dlgtext "txt5",  "Choose fourth field to index by (if applicable):"

                              dlgtext "txt6",  "Choose fifth field to index by (if applicable):"

                              dlgtext "txt7",  "Choose sixth field to index by (if applicable):"

                              dlgtext "txt8", "Choose field to calculate running balance based on.  For example, the ""AMOUNT"" field:"

                              dlgtext "PushButton1", "Back"

                              dlgtext "CancelButton1", "Cancel"

                              dlgtext "OKButton1", "OK"          

                             

                              dlgtext "txtTitleChooseField", "Running Balance Field"

                              dlgtext "txtTitleIndexField", "Index Field(s)"

                              dlgtext "txtTitleSelectDatabase", "ECAS Journal Entry Number Script"

                                            

               Else

                              temp(0)  = "Base de données courante" 

                              dlgtext "btnlng", "EN"

                              dlgtext "btnHelp", "Aide"

                              dlgtext "txt1", "Choisir le Grand Livre dans lequel vous voulez ajouter un champ d'écritures de journal:"

                              dlgtext "txt2",  "Choisir un premier champ à indexer:"

                              dlgtext "txt3",  "Choisir un second champ à indexer (si applicable):"

                              dlgtext "txt4",  "Choisir un troisième champ à indexer (si applicable):"

                              dlgtext "txt5",  "Choisir un quatrième champ à indexer (si applicable):"

                              dlgtext "txt6",  "Choisir un cinquième champ à indexer (si applicable):"

                              dlgtext "txt7",  "Choisir un sixième champ à indexer (si applicable):"

                              dlgtext "txt8", "Choisir un champ sur lequel calculer une balance cumulative. Par exemple: le champ 'MONTANT' :"

                              dlgtext "PushButton1", "Retour"

                              dlgtext "CancelButton1", "Annuler"

                              dlgtext "OKButton1", "OK"                         

 

                              dlgtext "txtTitleChooseField", "Champ de solde cumulatif"

                              dlgtext "txtTitleIndexField", "Champs à indexer"

                              dlgtext "txtTitleSelectDatabase", "Script de création d'un Numéro d'écriture SVI"                      

               End If

              

End Sub

 

 

Function getSettings()

               Dim WSHShell As Object

               Dim InstallInfoObj As Object

               Dim Contents As String

               Dim Filenum As Integer

               'get IDEA language

               Set InstallInfoObj = GetObject("", "Idea.InstallInfo")

               idealanguage = UCase(InstallInfoObj.AppLanguage)

               Set InstallInfoObj = Nothing

              

               'sets default Display Language same as IDEA display language. User can change this setting in the main GUI wimdow, top right corner.

               Dim LocalLib As String

               LocalLib=FindLocalLib()

               If Dir(LocalLib & "\Macros.ILB\ISR.ini") <> "" Then

                              Open LocalLib & "\Macros.ILB\ISR.ini" For Input As Filenum

                              Line Input #Filenum, Contents

                              GUILanguage = Contents

               End If

              

End Function

 

 

Function FindLocalLib() As String

               Dim ObjWshNw As Object

               Dim ObjInstall As Object

               Dim TestPath As String

               Dim fso As Object

               Dim templang As String

               Dim locallibname1 As String

               Dim locallibname2 As String

              

               Set ObjWshNw = CreateObject("WScript.Network")   

               Set fso = CreateObject("scripting.filesystemobject")

              

               TestPath= ""

               On Error Resume Next

               TestPath= Client.LocalLibraryPath

               If Left(TestPath,2) = "\\" Then

                              Dim InstallInfoObj As Object

                             

                              'get IDEA language

                              Set InstallInfoObj = GetObject("", "Idea.InstallInfo")

                              templang = UCase(InstallInfoObj.AppLanguage)

                              Set InstallInfoObj = Nothing

                             

                              If templang = "EN" Then

                                             locallibname1 = "My IDEA Documents"

                                             locallibname2 = "Local Library"                                

                              Else

                                             locallibname1 = "Mes documents IDEA"

                                             locallibname2 = "Bibliothèque locale"                                                                                                             

                              End If

                             

                              If fso.folderexists("C:\Users\Public\Documents") = false Then fso.createfolder("C:\Users\Public\Documents")

                              If fso.folderexists("C:\Users\Public\Documents\" & locallibname1) = false Then fso.createfolder("C:\Users\Public\Documents\" & locallibname1)

                              If fso.folderexists("C:\Users\Public\Documents\" & locallibname1 & "\" & locallibname2 ) = false Then fso.createfolder("C:\Users\Public\Documents\" & locallibname1 & "\" & locallibname2)

                              If fso.folderexists( "C:\Users\Public\Documents\" & locallibname1 & "\" & locallibname2 )  Then

                                             TestPath = "C:\Users\Public\Documents\" & locallibname1 & "\" & locallibname2

                              End If

               End If

               'MsgBox TestPath

                             

               If TestPath = "" Then      

                              Set ObjInstall = CreateObject("idea.ConfigureIdea")                         

                             

                              TestPath= ObjInstall.LocalLibraryPath

                              Set ObjInstall = Nothing               

              

                              If TestPath = "" Then                     

                                             Set ObjInstall = CreateObject("idea.ConfigureIdea")

                                             TestPath= ObjInstall.LocalLibraryCustomFunctionsPath

                                             TestPath = fso.getfolder(TestPath).parentfolder.path

                              End If

                                                           

               End If   

               Set ObjInstall = Nothing

              

               err.clear

               On Error GoTo 0

                                            

               If TestPath = "" Then      

                              If fso.folderexists("C:\Users\" & ObjWshNw.UserName & "\Documents\My IDEA Documents\Local Library") Then

                                             TestPath = "C:\Users\" & ObjWshNw.UserName & "\Documents\My IDEA Documents\Local Library"

                             

                              ElseIf fso.folderexists("C:\Users\" & ObjWshNw.UserName & "\Documents\Mes documents IDEA\Bibliothèque locale") Then

                                             TestPath = "C:\Users\" & ObjWshNw.UserName & "\Documents\Mes documents IDEA\Bibliothèque locale"

                             

                              ElseIf fso.folderexists("C:\Users\Public\Documents\My IDEA Documents\Local Library") Then

                                             TestPath = "C:\Users\Public\Documents\My IDEA Documents\Local Library"

                             

                              ElseIf fso.folderexists("C:\Users\Public\Documents\Mes documents IDEA\Bibliothèque locale") Then

                                             TestPath = "C:\Users\Public\Documents\Mes documents IDEA\Bibliothèque locale"

                              End If   

               End If

 

               If fso.folderexists(TestPath) And (UCase(Right(TestPath,19)) = "BIBLIOTHÈQUE LOCALE" Or UCase(Right(TestPath,13)) = "LOCAL LIBRARY" ) Then

'                             MsgBox "Local library should be: " & TestPath

               Else

'                             MsgBox "Error. No Local Library found! "

                              TestPath = ""

               End If

              

               Set ObjWshNw = Nothing

               Set fso = Nothing

               FindLocalLib = TestPath

End Function

 

John Heninger

 

 

    Computer Audit Specialist, Digital Compliance and Business Equity Valuations Division

     High Complexity Audit Tax Services Office / Western Region
     Canada Revenue Agency / Government of Canada
     john.heninger@cra-arc.gc.ca / Cell: 587-434-9671

    

     Spécialiste en vérification informatique , Division de l’observation numérique et de l’évaluation des biens mobiliers

     Bureau des services fiscaux de verification de complexité élevée / région de l'Ouest
     Agence du revenu du Canada / Gouvernement du Canada
     john.heninger@cra-arc.gc.ca / Cell. : 587-434-9671

 

 

 

 

 

Conversation opened. 1 read message.

Skip to content
Using Gmail with screen readers
2 of 24,436
idea ideas
Inbox
Heninger, John
	
Thu, Sep 18, 2:35 PM (2 days ago)
	
to me

custom function

new_virtual_field = IF [function] TRUE THEN [FUNCTION] , IF [function] FALSE THEN [function], THEN,

new_virtual_field = ....., THEN,

....

END

 

regex

string match

fill down

len

val

date

if

upper/lower

getnextvalue

getpreviousvalue

left

right

trim

recno

random

replace

remove

string/integer/date

 

 

complete regf.ideafunc custom function

<?xml version="1.0" encoding="utf-16"?>

<Function xmlns:xsd=http://www.w3.org/2001/XMLSchema xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xmlns=http://www.caseware-idea.com/>

    <Author>_userid_</Author>

    <DateModified>_date_</DateModified>

    <FunctionName>regf</FunctionName>

    <Help />

    <OutputType>Character</OutputType>

    <ScriptType>VbScript</ScriptType>

    <Category>Uncategorized</Category>

    <FunctionBody>Option Explicit

 

Function regf(input_string As String,regex_pattern As String,capture_group As Double) As String

    On Error GoTo ErrorHandler

 

    Dim RE As Object, allMatches As Object

    Dim results() As String

    Dim count As Integer, i As Integer

 

    ' Quick bail-outs

    If Len(input_string) = 0 Then

        regf = ""

        Exit Function

    End If

    If Len(regex_pattern) = 0 Then

        regf = ""

        Exit Function

    End If

    If capture_group &lt; 0 Then capture_group = 0

 

    ' Compile regex

    Set RE = CreateObject("vbscript.regexp")

    RE.Pattern = regex_pattern

    RE.Global = True

    RE.IgnoreCase = False

    RE.MultiLine = False

 

    Set allMatches = RE.Execute(input_string)

    count = allMatches.Count

    If count = 0 Then

        regf = ""

        Exit Function

    End If

 

    ReDim results(count - 1)

 

    For i = 0 To count - 1

        If capture_group = 0 Then

            results(i) = allMatches(i).Value

        ElseIf allMatches(i).SubMatches.Count &gt;= capture_group Then

            results(i) = allMatches(i).SubMatches(capture_group - 1)

        Else

            results(i) = ""

        End If

    Next

 

    regf = JoinArray(results, "|")

    Exit Function

 

ErrorHandler:

    regf = ""

    On Error Resume Next

    Set allMatches = Nothing

    Set RE = Nothing

End Function

 

' Helper function to replace VBScript's Join (not always available in IDEA)

Private Function JoinArray(arr() As String, sep As String) As String

    Dim i As Integer, result As String

    result = ""

    For i = LBound(arr) To UBound(arr)

        If Len(arr(i)) &gt; 0 Then

            If Len(result) = 0 Then

                result = arr(i)

            Else

                result = result &amp; sep &amp; arr(i)

            End If

        End If

    Next

    JoinArray = result

End Function

 

</FunctionBody>

    <Parameters>

        <Parameter>

            <Type>Character</Type>

            <Name>input_string</Name>

            <Help>field/text</Help>

        </Parameter>

        <Parameter>

            <Type>Character</Type>

            <Name>regex_pattern</Name>

            <Help>regex pattern</Help>

        </Parameter>

        <Parameter>

            <Type>Numeric</Type>

            <Name>capture_group</Name>

            <Help>capture group num</Help>

        </Parameter>

    </Parameters>

</Function>

 

 

 

 
	
